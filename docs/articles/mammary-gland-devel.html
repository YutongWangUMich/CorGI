<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mammary gland development • corgi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mammary gland development">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">corgi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/corgi.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/embryo-devel.html">Pre-implantation embryo development in human and mouse</a>
    </li>
    <li>
      <a href="../articles/liver-bud.html">Liver bud development</a>
    </li>
    <li>
      <a href="../articles/mammary-gland-devel.html">Mammary gland development</a>
    </li>
    <li>
      <a href="../articles/neurogenesis.html">Neurogenesis in the SVZ</a>
    </li>
    <li>
      <a href="../articles/toy-example.html">Synthetic data example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Mammary gland development</h1>
                        <h4 class="author">Yutong Wang</h4>
            
            <h4 class="date">2019-02-05</h4>
      
      
      <div class="hidden name"><code>mammary-gland-devel.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(corgi)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scmap)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(knitr) <span class="co"># for printing nice looking tables</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2) <span class="co"># for creating pretty plots</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(cowplot) <span class="co"># for creating panel of plots</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(forcats) <span class="co"># for concatenating factors</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scmap) <span class="co"># for the compared feature selection method</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scran)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(GEOquery)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Matrix)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(biomaRt)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">mart &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/biomaRt/topics/useMart">useMart</a></span>(<span class="st">"ensembl"</span>, </a>
<a class="sourceLine" id="cb1-14" data-line-number="14">                <span class="dt">dataset =</span> <span class="st">"mmusculus_gene_ensembl"</span>, </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">                <span class="dt">host=</span><span class="st">"www.ensembl.org"</span> )</a></code></pre></div>
<div id="pal-et-al-2017-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#pal-et-al-2017-dataset" class="anchor"></a>Pal et al. 2017 dataset</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE95434&amp;format=file&amp;file=GSE95434%5FGeneCounts%2Etxt%2Egz"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  )</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">pal_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt),<span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">pal_raw[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;       GeneID Length X2wk.1 X2wk.2 X2wk.3 X2wk.4</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 1     497097   3634      1      0      0      0</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; 2  100503874   3259    126      0      0      4</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; 3  100038431   1634      0      0      0      0</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; 4      19888   9747      0      0      0      0</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; 5      20671   3130      0      0      0      0</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; 6      27395   4203      0      0      1      0</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; 7      18777   2433   2264      2      0    135</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; 8  100503730    799      0      0      0      0</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; 9      21399   2847    126     61      8     74</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; 10     58175   2241      0      0      0      0</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">pal &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(pal_raw[,<span class="dv">3</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(pal_raw)])))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(pal)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [1] 27179   346</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">pal_entrezGeneID &lt;-<span class="st"> </span>pal_raw[,<span class="dv">1</span>]</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">pal<span class="op">$</span>cell_type &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(pal) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x,<span class="dt">split =</span> <span class="st">"."</span>,<span class="dt">fixed =</span> T)[[<span class="dv">1</span>]][<span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="dt">pattern =</span> <span class="st">"X"</span>,<span class="dt">replacement =</span> <span class="st">""</span>,<span class="dt">x =</span> x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span>unlist <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2wk"</span>,<span class="st">"4wk"</span>,<span class="st">"10wk"</span>),<span class="dt">ordered =</span> T)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  2wk  4wk 10wk </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  144  136   66</span></a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Change the names from entrezgene to mgi_symbol</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">features &lt;-<span class="st"> </span>pal_entrezGeneID</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/biomaRt/topics/getBM">getBM</a></span>(<span class="dt">attributes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"entrezgene"</span>, <span class="st">"mgi_symbol"</span>), </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">             <span class="dt">values =</span> features, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">             <span class="dt">mart =</span> mart,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">             <span class="dt">filters =</span> <span class="st">"entrezgene"</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(out)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;   entrezgene mgi_symbol</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; 1  100039596      Tcf24</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; 2  100042065     Gm3646</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; 3  100101919     Dnah7c</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; 4  100504323    Gm20172</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; 5     104086    Cyp27a1</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; 6     107527     Il1rl2</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(out)</a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; [1] 21035     2</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">out<span class="op">$</span>is_unique &lt;-<span class="st"> </span><span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out<span class="op">$</span>mgi_symbol)</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">out<span class="op">$</span>is_nonempty &lt;-<span class="st"> </span>out<span class="op">$</span>mgi_symbol<span class="op">!=</span><span class="st">""</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20">out_unique_nonempty &lt;-<span class="st"> </span>out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(is_unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(is_nonempty)</a></code></pre></div>
<p>Just to be sure</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out_unique_nonempty<span class="op">$</span>mgi_symbol))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(out_unique_nonempty<span class="op">$</span>mgi_symbol<span class="op">==</span><span class="st">""</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>Transform to MGI symbols</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">genes_use &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(pal_entrezGeneID <span class="op">%in%</span><span class="st"> </span>out_unique_nonempty<span class="op">$</span>entrezgene)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">pal &lt;-<span class="st"> </span>pal[genes_use,]</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(pal) &lt;-</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="dt">x =</span> pal_entrezGeneID[genes_use],</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    <span class="dt">from =</span> out_unique_nonempty<span class="op">$</span>entrezgene,</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    <span class="dt">to =</span> out_unique_nonempty<span class="op">$</span>mgi_symbol</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  )</a></code></pre></div>
</div>
<div id="giraddi-et-al-2018-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#giraddi-et-al-2018-dataset" class="anchor"></a>Giraddi et al. 2018 dataset</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE111113&amp;format=file&amp;file=GSE111113%5FTable%5FS1%5FFilterNormal10xExpMatrix%2Etxt%2Egz"</span>))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">giraddi_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.delim2</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt))</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(giraddi_raw))</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; [1] "gene_id"              "transcript_id.s."     "X"                   </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; [4] "E16_AAACGGGCATGTTCCC" "E16_AAAGCAAAGATGTAAC" "E16_AAATGCCAGCTCCTTC"</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(giraddi_raw<span class="op">$</span>gene_id)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; [1] ENSMUSG00000092341 ENSMUSG00000093674 ENSMUSG00000064357</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; [4] ENSMUSG00000064358 ENSMUSG00000040952 ENSMUSG00000057841</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; 22184 Levels: ENSMUSG00000000001 ENSMUSG00000000028 ... mL1-GFP_reporter</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(giraddi_raw<span class="op">$</span>X) <span class="co"># the "X" column is where the MGI symbol for the gene names are stored</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; [1] Malat1  Rpl41   mt-Atp6 mt-Co3  Rps19   Rpl32  </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 21962 Levels:  0 0610005C13Rik 0610007N19Rik 0610007P14Rik ... Zzz3</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co"># remove duplicated MGI symbols</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18">giraddi_raw &lt;-<span class="st"> </span>giraddi_raw[<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(giraddi_raw<span class="op">$</span>X),]</a>
<a class="sourceLine" id="cb8-19" data-line-number="19"></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co"># remove empty string names</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21">giraddi_raw &lt;-<span class="st"> </span>giraddi_raw[giraddi_raw<span class="op">$</span>X<span class="op">!=</span><span class="st">""</span>,]</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"></a>
<a class="sourceLine" id="cb8-23" data-line-number="23">giraddi &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(giraddi_raw[,<span class="dv">4</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(giraddi_raw)])))</a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi) &lt;-<span class="st"> </span>giraddi_raw<span class="op">$</span>X</a>
<a class="sourceLine" id="cb8-25" data-line-number="25"></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"></a>
<a class="sourceLine" id="cb8-27" data-line-number="27">giraddi<span class="op">$</span>cell_type &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(giraddi),<span class="dt">split =</span> <span class="st">"_"</span>),<span class="cf">function</span>(x) x[<span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>()</a>
<a class="sourceLine" id="cb8-31" data-line-number="31"></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(giraddi<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt; [1] "Adu1"   "Adu2"   "AduBas" "E16"    "E18"    "P4"</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"></a>
<a class="sourceLine" id="cb8-35" data-line-number="35">giraddi<span class="op">$</span>cell_type &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb8-36" data-line-number="36">  <span class="dt">x =</span> giraddi<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb8-37" data-line-number="37">  <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(giraddi<span class="op">$</span>cell_type),</a>
<a class="sourceLine" id="cb8-38" data-line-number="38">  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Adu"</span>, <span class="st">"Adu"</span>, <span class="st">"AduBas"</span>, <span class="st">"E16"</span>, <span class="st">"E18"</span>, <span class="st">"P4"</span>)</a>
<a class="sourceLine" id="cb8-39" data-line-number="39">)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(pal),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">pal &lt;-<span class="st"> </span>pal[shared_genes,]</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">giraddi &lt;-<span class="st"> </span>giraddi[shared_genes,]</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(shared_genes)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; [1] 15314</span></a></code></pre></div>
<p>Filter out cells where less than 5% of the genes are expressed</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;  2wk  4wk 10wk </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;  144  136   66</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">pal &lt;-<span class="st"> </span>pal[,<span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/colSums">colMeans</a></span>(<span class="kw">counts</span>(pal)<span class="op">&gt;</span><span class="dv">0</span>)<span class="op">&gt;</span><span class="fl">0.05</span>]</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  2wk  4wk 10wk </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  142  133   59</span></a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(giraddi<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt;    Adu AduBas    E16    E18     P4 </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt;   2848    714    650   1008    840</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">giraddi &lt;-<span class="st"> </span>giraddi[,<span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/colSums">colMeans</a></span>(<span class="kw">counts</span>(giraddi)<span class="op">&gt;</span><span class="dv">0</span>)<span class="op">&gt;</span><span class="fl">0.05</span>]</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(giraddi<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;    Adu AduBas    E16    E18     P4 </span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;   2769    714    650   1007    835</span></a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">x =</span> pal<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2wk"</span>,<span class="st">"4wk"</span>,<span class="st">"10wk"</span>),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2wk"</span>,<span class="st">"4wk"</span>,<span class="st">"Adu"</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">) -&gt;</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span>pal<span class="op">$</span>cell_type</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">batches &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">Pal =</span> pal)</a></code></pre></div>
</div>
<div id="corgi-feature-selection-on-the-pal-and-giraddi-datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#corgi-feature-selection-on-the-pal-and-giraddi-datasets" class="anchor"></a>CorGI feature selection on the Pal and Giraddi datasets</h1>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">corgi_output_MG_devel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_corgi.html">run_corgi</a></span>(<span class="kw">counts</span>(pal),<span class="kw">counts</span>(giraddi))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt; [1] "2019-02-05 03:17:48 EST"</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt; [1] "number of cores used"</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; [1] 15314</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; Time difference of 10.23887 mins</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt; [1] "2019-02-05 03:28:02 EST"</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; [1] "number of cores used"</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; [1] 11451</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; Time difference of 10.18108 mins</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; [1] "2019-02-05 03:38:13 EST"</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; [1] "number of cores used"</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt; [1] 8850</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; Time difference of 10.14658 mins</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; [1] "2019-02-05 03:48:22 EST"</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt; [1] "number of cores used"</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt; [1] 6983</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt; Time difference of 10.12357 mins</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt; [1] "2019-02-05 03:58:29 EST"</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt; [1] "number of cores used"</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt; [1] 5532</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">#&gt; Time difference of 10.10129 mins</span></a>
<a class="sourceLine" id="cb14-28" data-line-number="28"><span class="co">#&gt; [1] "2019-02-05 04:08:35 EST"</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29"><span class="co">#&gt; [1] "number of cores used"</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31"><span class="co">#&gt; [1] 4453</span></a>
<a class="sourceLine" id="cb14-32" data-line-number="32"><span class="co">#&gt; Time difference of 10.08797 mins</span></a></code></pre></div>
</div>
<div id="curate-the-gene-sets-for-comparison" class="section level1">
<h1 class="hasAnchor">
<a href="#curate-the-gene-sets-for-comparison" class="anchor"></a>Curate the gene sets for comparison</h1>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">rowData</span>(pal)<span class="op">$</span>feature_symbols &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(pal)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">rowData</span>(giraddi)<span class="op">$</span>feature_symbols &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">corgi_gene_set &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_top_corgi_genes.html">select_top_corgi_genes</a></span>(corgi_output_MG_devel,<span class="dt">n =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co"># mbn = abbrev for multiBatchNorm</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">mbn_out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/multiBatchNorm">multiBatchNorm</a></span>(pal,giraddi) </a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">HDG_ranking &lt;-<span class="st"> </span><span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="kw">rowData</span>(sce)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  sce &lt;-<span class="st"> </span>scmap<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/scmap/topics/selectFeatures">selectFeatures</a></span>(sce)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(<span class="kw">rowData</span>(sce)[[<span class="st">"scmap_scores"</span>]],<span class="dt">decreasing =</span> T,<span class="dt">na.last =</span> T)])</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">n &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(corgi_gene_set)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">gene_sets &lt;-<span class="st"> </span><span class="kw">get_compared_gene_sets</span>(</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  <span class="dt">batch1_top_genes =</span> <span class="kw">HDG_ranking</span>(mbn_out[[<span class="dv">1</span>]]),</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">  <span class="dt">batch1_name =</span> <span class="st">"HDG(Pal)"</span>,</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">  <span class="dt">batch2_top_genes =</span> <span class="kw">HDG_ranking</span>(mbn_out[[<span class="dv">2</span>]]), </a>
<a class="sourceLine" id="cb16-13" data-line-number="13">  <span class="dt">batch2_name =</span> <span class="st">"HDG(Giraddi)"</span>,</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">  <span class="dt">desired_size =</span> n)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; [1] 559</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt; [1] 558</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"></a>
<a class="sourceLine" id="cb16-22" data-line-number="22">gene_sets[[<span class="st">"CorGI"</span>]] &lt;-<span class="st"> </span>corgi_gene_set</a>
<a class="sourceLine" id="cb16-23" data-line-number="23">gene_sets &lt;-<span class="st"> </span>gene_sets[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)]</a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(gene_sets, length)</a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt; $CorGI</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt; $`HDG(Pal)`</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31"><span class="co">#&gt; $`HDG(Giraddi)`</span></a>
<a class="sourceLine" id="cb16-32" data-line-number="32"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb16-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-34" data-line-number="34"><span class="co">#&gt; $Union</span></a>
<a class="sourceLine" id="cb16-35" data-line-number="35"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb16-36" data-line-number="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-37" data-line-number="37"><span class="co">#&gt; $Intersection</span></a>
<a class="sourceLine" id="cb16-38" data-line-number="38"><span class="co">#&gt; [1] 1000</span></a></code></pre></div>
<p>Subsample the Giraddi dataset for visualization</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">sample_cells &lt;-<span class="st"> </span><span class="cf">function</span>(object, n){</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(object[,<span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(object),n)])</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">giraddi &lt;-<span class="st"> </span><span class="kw">sample_cells</span>(giraddi,<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">cell_type &lt;-<span class="st"> </span>forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_c.html">fct_c</a></span>(giraddi<span class="op">$</span>cell_type,pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">batch &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Giraddi"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(giraddi)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Pal"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(pal)))</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">comb &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw">counts</span>(giraddi),<span class="kw">counts</span>(pal))</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">corgi_gene_set &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_top_corgi_genes.html">select_top_corgi_genes</a></span>(corgi_output_MG_devel,<span class="dt">n =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">D &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cor</a></span>(comb[corgi_gene_set,],<span class="dt">method =</span> <span class="st">"spearman"</span>))<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">mds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cmdscale">cmdscale</a></span>(D,<span class="dt">k=</span><span class="dv">2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(mds[,<span class="dv">1</span>],mds[,<span class="dv">2</span>],<span class="dt">color =</span> cell_type,<span class="dt">shape =</span> batch) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span>(<span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">16</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>))</a></code></pre></div>
<p><img src="mammary-gland-devel_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div id="wuidart-et-al-2018-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#wuidart-et-al-2018-dataset" class="anchor"></a>Wuidart et al. 2018 dataset</h1>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE110nnn/GSE110351/suppl/GSE110351_MG_EMP_LC_BC_raw_counts.csv.gz"</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  )</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">wuidart_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt))</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">wuidart_raw[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;                       X AAGAGGCA.AAGGAGTA AAGAGGCA.AAGGCTAT</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt; 1  ENSMUSG00000000001.4                 0                 0</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt; 2 ENSMUSG00000000003.15                 0                 0</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt; 3 ENSMUSG00000000028.14                 0                 0</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt; 4 ENSMUSG00000000031.15                 0               164</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt; 5 ENSMUSG00000000037.16                 0                 0</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt;   AAGAGGCA.ACTGCATA AAGAGGCA.CCTAGAGT</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt; 1              1376               331</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; 2                 0                 0</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; 3                 0                 0</span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt; 4                 0                 1</span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt; 5                 0                 0</span></a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">wuidart &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(wuidart_raw[,<span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(wuidart_raw)])))</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co"># First column of gse is the gene names</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) &lt;-<span class="st"> </span>wuidart_raw[,<span class="dv">1</span>]</a></code></pre></div>
<p>Remove the spike-ins</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">wuidart &lt;-<span class="st"> </span>wuidart[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="st">"ENSMUSG"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart)),]</a></code></pre></div>
<p>Let us convert ENSEMBL to MGI symbols for the genes</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart))</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co">#&gt; [1] "ENSMUSG00000000001.4"  "ENSMUSG00000000003.15" "ENSMUSG00000000028.14"</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">#&gt; [4] "ENSMUSG00000000031.15" "ENSMUSG00000000037.16" "ENSMUSG00000000049.11"</span></a></code></pre></div>
<p>We need to remove the dots</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x){ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x,<span class="dt">split =</span> <span class="st">"."</span>,<span class="dt">fixed =</span> T)[[<span class="dv">1</span>]][<span class="dv">1</span>] }</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart), f))</a></code></pre></div>
<p>Does this cause any duplicates?</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart)))</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># Get the MGI symbols</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/biomaRt/topics/getBM">getBM</a></span>(<span class="dt">attributes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ensembl_gene_id"</span>, <span class="st">"mgi_symbol"</span>), </a>
<a class="sourceLine" id="cb26-3" data-line-number="3">             <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart), </a>
<a class="sourceLine" id="cb26-4" data-line-number="4">             <span class="dt">mart =</span> mart,</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">             <span class="dt">filters =</span> <span class="st">"ensembl_gene_id"</span>)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6"></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co"># Remove duplicates</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8">out &lt;-<span class="st"> </span>out[(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out<span class="op">$</span>ensembl_gene_id)) <span class="op">&amp;</span><span class="st"> </span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out<span class="op">$</span>mgi_symbol)),]</a>
<a class="sourceLine" id="cb26-9" data-line-number="9"></a>
<a class="sourceLine" id="cb26-10" data-line-number="10">wuidart &lt;-<span class="st"> </span>wuidart[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) <span class="op">%in%</span><span class="st"> </span>out<span class="op">$</span>ensembl_gene_id,]</a>
<a class="sourceLine" id="cb26-11" data-line-number="11"></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart),</a>
<a class="sourceLine" id="cb26-13" data-line-number="13">                                     <span class="dt">from =</span> out<span class="op">$</span>ensembl_gene_id,</a>
<a class="sourceLine" id="cb26-14" data-line-number="14">                                     <span class="dt">to =</span> out<span class="op">$</span>mgi_symbol)</a></code></pre></div>
<p>Now we need to get the metadata</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">gse &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/GEOquery/topics/getGEO">getGEO</a></span>(<span class="st">"GSE110351"</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">md_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(gse<span class="op">$</span>GSE110351_series_matrix.txt.gz<span class="op">$</span>title)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(md_raw) <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(wuidart)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">md &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">raw =</span> md_raw,<span class="dt">stringsAsFactors =</span> F)</a></code></pre></div>
<p>The cell barcodes are the last 17 characters (including the dash)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">md<span class="op">$</span>raw[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="co">#&gt; [1] "50 Cell Control Basal TAAGGCGA-CTCTCTAT"  </span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="co">#&gt; [2] "50 Cell Control Luminal CGTACTAG-CTCTCTAT"</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="co">#&gt; [3] "Single Basal Cell AGGCAGAA-CTCTCTAT"      </span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#&gt; [4] "Single Basal Cell TCCTGAGC-CTCTCTAT"      </span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="co">#&gt; [5] "Single Basal Cell GGACTCCT-CTCTCTAT"</span></a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">substrRight &lt;-<span class="st"> </span><span class="cf">function</span>(x, n){</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>(x, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(x)<span class="op">-</span>n<span class="op">+</span><span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(x))</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">md<span class="op">$</span>barcodes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(md<span class="op">$</span>raw,<span class="cf">function</span>(x) <span class="kw">substrRight</span>(x,<span class="dv">17</span>)))</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">md<span class="op">$</span>barcodes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"-"</span>,<span class="st">"."</span>,md<span class="op">$</span>barcodes)</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">md &lt;-<span class="st"> </span>md[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(md<span class="op">$</span>barcodes),]</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">wuidart &lt;-<span class="st"> </span>wuidart[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(wuidart))]</a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(wuidart) <span class="op">==</span><span class="st"> </span>md<span class="op">$</span>barcodes)</a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">removeRight &lt;-<span class="st"> </span><span class="cf">function</span>(x, n){</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>(x, <span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(x)<span class="op">-</span>n)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">md<span class="op">$</span>raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(md<span class="op">$</span>raw,<span class="cf">function</span>(x) <span class="kw">removeRight</span>(x,<span class="dv">18</span>)))</a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(md<span class="op">$</span>raw)</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co">#&gt;                50 Cell Control Basal 50 Cell Control Embryonal Progenitor </span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="co">#&gt;                                    1                                    1 </span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="co">#&gt;              50 Cell Control Luminal                     Negative Control </span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="co">#&gt;                                    1                                    4 </span></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="co">#&gt;                    Single Basal Cell     Single Embryonal Progenitor Cell </span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="co">#&gt;                                  118                                  137 </span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="co">#&gt;                  Single Luminal Cell </span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co">#&gt;                                  122</span></a></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">md<span class="op">$</span>is_single_cell &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Single"</span>,md<span class="op">$</span>raw)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">md<span class="op">$</span>cell_type &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="cf">for</span>(ct <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Basal"</span>,<span class="st">"Luminal"</span>,<span class="st">"Embryonal Progenitor"</span>)){</a>
<a class="sourceLine" id="cb31-4" data-line-number="4">  md<span class="op">$</span>cell_type[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(ct,md<span class="op">$</span>raw)] &lt;-<span class="st"> </span>ct</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">}</a></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">wuidart<span class="op">$</span>is_single_cell &lt;-<span class="st"> </span>md<span class="op">$</span>is_single_cell</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">wuidart<span class="op">$</span>cell_type &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(md<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">wuidart &lt;-<span class="st"> </span>wuidart[,wuidart<span class="op">$</span>is_single_cell]</a></code></pre></div>
<p>Did we miss anything?</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(wuidart<span class="op">$</span>cell_type))</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  <span class="dt">x =</span> wuidart<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">  <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Basal"</span>,<span class="st">"Luminal"</span>,<span class="st">"Embryonal Progenitor"</span>),</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">  <span class="dt">to =</span>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Basal"</span>,<span class="st">"Luminal"</span>,<span class="st">"EMP"</span>)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">) -&gt;<span class="st"> </span>wuidart<span class="op">$</span>cell_type</a></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">batches[[<span class="st">"Wuidart"</span>]] &lt;-<span class="st"> </span>wuidart</a></code></pre></div>
</div>
<div id="bach-et-al-2017-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#bach-et-al-2017-dataset" class="anchor"></a>Bach et al. 2017 dataset</h1>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">bach_np1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/externalFormats">readMM</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/samples/GSM2834nnn/GSM2834498/suppl/GSM2834498_NP_1_matrix.mtx.gz"</span>)))</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(bach_np1)</a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="co">#&gt; [1] 27998  2249</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"></a>
<a class="sourceLine" id="cb36-5" data-line-number="5">bach_np2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/externalFormats">readMM</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/samples/GSM2834nnn/GSM2834499/suppl/GSM2834499_NP_2_matrix.mtx.gz"</span>)))</a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(bach_np2)</a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="co">#&gt; [1] 27998  2127</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8"></a>
<a class="sourceLine" id="cb36-9" data-line-number="9"><span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE106nnn/GSE106273/suppl/GSE106273_combined_genes.tsv.gz"</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="st">  </span>url <span class="op">%&gt;%</span><span class="st"> </span>gzcon <span class="op">%&gt;%</span><span class="st"> </span>readLines <span class="op">%&gt;%</span><span class="st"> </span>textConnection <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(<span class="dt">stringsAsFactors =</span> F) -&gt;</a>
<a class="sourceLine" id="cb36-11" data-line-number="11"><span class="st">  </span>bach_genes</a>
<a class="sourceLine" id="cb36-12" data-line-number="12"></a>
<a class="sourceLine" id="cb36-13" data-line-number="13">bach_genes[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</a>
<a class="sourceLine" id="cb36-14" data-line-number="14"><span class="co">#&gt;                   V1      V2</span></a>
<a class="sourceLine" id="cb36-15" data-line-number="15"><span class="co">#&gt; 1 ENSMUSG00000051951    Xkr4</span></a>
<a class="sourceLine" id="cb36-16" data-line-number="16"><span class="co">#&gt; 2 ENSMUSG00000089699  Gm1992</span></a>
<a class="sourceLine" id="cb36-17" data-line-number="17"><span class="co">#&gt; 3 ENSMUSG00000102343 Gm37381</span></a>
<a class="sourceLine" id="cb36-18" data-line-number="18"><span class="co">#&gt; 4 ENSMUSG00000025900     Rp1</span></a>
<a class="sourceLine" id="cb36-19" data-line-number="19"><span class="co">#&gt; 5 ENSMUSG00000109048     Rp1</span></a>
<a class="sourceLine" id="cb36-20" data-line-number="20"></a>
<a class="sourceLine" id="cb36-21" data-line-number="21"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb36-22" data-line-number="22">bach_np1 &lt;-<span class="st"> </span><span class="kw">sample_cells</span>(bach_np1,<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb36-23" data-line-number="23">bach_np2 &lt;-<span class="st"> </span><span class="kw">sample_cells</span>(bach_np2,<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb36-24" data-line-number="24">bach_np &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(bach_np1,bach_np2)</a>
<a class="sourceLine" id="cb36-25" data-line-number="25"></a>
<a class="sourceLine" id="cb36-26" data-line-number="26">bach_np &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(bach_np)))</a>
<a class="sourceLine" id="cb36-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(bach_np) &lt;-<span class="st"> </span>bach_genes[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb36-28" data-line-number="28"></a>
<a class="sourceLine" id="cb36-29" data-line-number="29"></a>
<a class="sourceLine" id="cb36-30" data-line-number="30">bach_np<span class="op">$</span>cell_type &lt;-<span class="st"> "Adu"</span></a>
<a class="sourceLine" id="cb36-31" data-line-number="31">bach_np<span class="op">$</span>cell_type &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(bach_np<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb36-32" data-line-number="32"></a>
<a class="sourceLine" id="cb36-33" data-line-number="33">batches[[<span class="st">"Bach_NP"</span>]] &lt;-<span class="st"> </span>bach_np</a></code></pre></div>
</div>
<div id="reproducing-the-paper-figures" class="section level1">
<h1 class="hasAnchor">
<a href="#reproducing-the-paper-figures" class="anchor"></a>Reproducing the paper figures</h1>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">  <span class="dt">X =</span> batches,</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">  <span class="dt">FUN =</span> <span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">    shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce))</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">    combined &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw">counts</span>(giraddi[shared_genes,]),</a>
<a class="sourceLine" id="cb37-7" data-line-number="7">                      <span class="kw">counts</span>(sce[shared_genes,]))</a>
<a class="sourceLine" id="cb37-8" data-line-number="8">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb37-9" data-line-number="9">      <span class="dt">X =</span> gene_sets,</a>
<a class="sourceLine" id="cb37-10" data-line-number="10">      <span class="dt">FUN =</span> <span class="cf">function</span>(gene_set) {</a>
<a class="sourceLine" id="cb37-11" data-line-number="11">        gene_set &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(gene_set, shared_genes)</a>
<a class="sourceLine" id="cb37-12" data-line-number="12">        D &lt;-</a>
<a class="sourceLine" id="cb37-13" data-line-number="13"><span class="st">          </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cor</a></span>(combined[gene_set, ], <span class="dt">method =</span> <span class="st">"spearman"</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb37-14" data-line-number="14">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cmdscale">cmdscale</a></span>(D, <span class="dt">k =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb37-15" data-line-number="15">      }</a>
<a class="sourceLine" id="cb37-16" data-line-number="16">    )</a>
<a class="sourceLine" id="cb37-17" data-line-number="17">  }) -&gt;<span class="st"> </span>embeddings_mds</a>
<a class="sourceLine" id="cb37-18" data-line-number="18"></a>
<a class="sourceLine" id="cb37-19" data-line-number="19"></a>
<a class="sourceLine" id="cb37-20" data-line-number="20"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb37-21" data-line-number="21">  <span class="dt">X =</span> batches,</a>
<a class="sourceLine" id="cb37-22" data-line-number="22">  <span class="dt">FUN =</span> <span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb37-23" data-line-number="23">    shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce))</a>
<a class="sourceLine" id="cb37-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb37-25" data-line-number="25">    mbn_out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/multiBatchNorm">multiBatchNorm</a></span>(giraddi[shared_genes,],</a>
<a class="sourceLine" id="cb37-26" data-line-number="26">                              sce[shared_genes,])</a>
<a class="sourceLine" id="cb37-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb37-28" data-line-number="28">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb37-29" data-line-number="29">      <span class="dt">X =</span> gene_sets,</a>
<a class="sourceLine" id="cb37-30" data-line-number="30">      <span class="dt">FUN =</span> <span class="cf">function</span>(gene_set) {</a>
<a class="sourceLine" id="cb37-31" data-line-number="31">        gene_set &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(gene_set, shared_genes)</a>
<a class="sourceLine" id="cb37-32" data-line-number="32">        mnn.out &lt;-</a>
<a class="sourceLine" id="cb37-33" data-line-number="33"><span class="st">          </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/mnnCorrect">mnnCorrect</a></span>(<span class="kw">logcounts</span>(mbn_out[[<span class="dv">1</span>]][gene_set, ]),</a>
<a class="sourceLine" id="cb37-34" data-line-number="34">                     <span class="kw">logcounts</span>(mbn_out[[<span class="dv">2</span>]][gene_set, ]))</a>
<a class="sourceLine" id="cb37-35" data-line-number="35">        t.mnn &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(cbind, mnn.out<span class="op">$</span>corrected)))</a>
<a class="sourceLine" id="cb37-36" data-line-number="36">        <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/prcomp">prcomp</a></span>(t.mnn, <span class="dt">rank =</span> <span class="dv">2</span>)<span class="op">$</span>x</a>
<a class="sourceLine" id="cb37-37" data-line-number="37">      }</a>
<a class="sourceLine" id="cb37-38" data-line-number="38">    )</a>
<a class="sourceLine" id="cb37-39" data-line-number="39">  }) -&gt;<span class="st"> </span>embeddings_mnn</a></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">my_shape_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">16</span>)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">my_color_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"></a>
<a class="sourceLine" id="cb38-4" data-line-number="4">get_scatterplots &lt;-<span class="st"> </span><span class="cf">function</span>(embeddings, batch, cell_type){</a>
<a class="sourceLine" id="cb38-5" data-line-number="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">X =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(gene_sets),</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">         <span class="dt">FUN =</span> <span class="cf">function</span>(gs_name) {</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">           emb &lt;-<span class="st"> </span>embeddings[[gs_name]]</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">           <span class="kw">plot_dimensionality_reduction</span>(emb, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(batch), cell_type) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"><span class="st">             </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span>(<span class="dt">values =</span> my_shape_palette) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="st">             </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="dt">values =</span> my_color_palette) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11"><span class="st">             </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(gs_name, <span class="st">", "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(corgi<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/corgi/topics/batch_mixing">batch_mixing</a></span>(emb, batch), <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb38-12" data-line-number="12">         })</a>
<a class="sourceLine" id="cb38-13" data-line-number="13">}</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">color_palettes &lt;-</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">Pal =</span> my_color_palette[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>)],</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">       <span class="dt">Wuidart =</span> my_color_palette[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)],</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">       <span class="dt">Bach_NP =</span> my_color_palette[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>)])</a>
<a class="sourceLine" id="cb39-5" data-line-number="5"></a>
<a class="sourceLine" id="cb39-6" data-line-number="6"></a>
<a class="sourceLine" id="cb39-7" data-line-number="7">get_panel_for_dr &lt;-<span class="st"> </span><span class="cf">function</span>(embeddings_dr, emb_name,gene_sets_use){</a>
<a class="sourceLine" id="cb39-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb39-9" data-line-number="9">    <span class="dt">X =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(batches),</a>
<a class="sourceLine" id="cb39-10" data-line-number="10">    <span class="dt">FUN =</span> <span class="cf">function</span>(batch_name) {</a>
<a class="sourceLine" id="cb39-11" data-line-number="11">      sce &lt;-<span class="st"> </span>batches[[batch_name]]</a>
<a class="sourceLine" id="cb39-12" data-line-number="12">      cell_type &lt;-<span class="st"> </span>forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_c.html">fct_c</a></span>(giraddi<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb39-13" data-line-number="13">                                  sce<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb39-14" data-line-number="14">      batch &lt;-</a>
<a class="sourceLine" id="cb39-15" data-line-number="15"><span class="st">        </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Giraddi"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(giraddi)), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(batch_name, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(sce)))</a>
<a class="sourceLine" id="cb39-16" data-line-number="16">      <span class="kw">get_scatterplots</span>(embeddings_dr[[batch_name]],</a>
<a class="sourceLine" id="cb39-17" data-line-number="17">                       <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(batch),</a>
<a class="sourceLine" id="cb39-18" data-line-number="18">                       cell_type) -&gt;<span class="st"> </span>plts</a>
<a class="sourceLine" id="cb39-19" data-line-number="19">      plts &lt;-<span class="st"> </span>plts[gene_sets_use]</a>
<a class="sourceLine" id="cb39-20" data-line-number="20">      <span class="kw">get_color_legend</span>(cell_type[batch <span class="op">==</span><span class="st"> </span>batch_name],</a>
<a class="sourceLine" id="cb39-21" data-line-number="21">                       color_palettes[[batch_name]],</a>
<a class="sourceLine" id="cb39-22" data-line-number="22">                       <span class="dt">legend.title =</span> batch_name) -&gt;<span class="st"> </span>plts[[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(plts)<span class="op">+</span><span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb39-23" data-line-number="23">      plts[[<span class="st">"nrow"</span>]] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb39-24" data-line-number="24">      plts[[<span class="st">"rel_widths"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">2</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(gene_sets_use)), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb39-25" data-line-number="25">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(<span class="dt">what =</span> plot_grid, <span class="dt">args =</span> plts)</a>
<a class="sourceLine" id="cb39-26" data-line-number="26">      </a>
<a class="sourceLine" id="cb39-27" data-line-number="27">    }</a>
<a class="sourceLine" id="cb39-28" data-line-number="28">  ) -&gt;<span class="st"> </span>panel_rows</a>
<a class="sourceLine" id="cb39-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb39-30" data-line-number="30">  <span class="kw">get_color_legend</span>(cell_type[batch <span class="op">==</span><span class="st"> "Giraddi"</span>],</a>
<a class="sourceLine" id="cb39-31" data-line-number="31">                   my_color_palette,</a>
<a class="sourceLine" id="cb39-32" data-line-number="32">                   <span class="dt">legend.title =</span> <span class="st">"Giraddi"</span>,</a>
<a class="sourceLine" id="cb39-33" data-line-number="33">                   <span class="dt">legend.position =</span> <span class="st">"bottom"</span>) -&gt;</a>
<a class="sourceLine" id="cb39-34" data-line-number="34"><span class="st">    </span>giraddi_color_lgnd</a>
<a class="sourceLine" id="cb39-35" data-line-number="35">  <span class="kw"><a href="../reference/get_axes_legend.html">get_axes_legend</a></span>(emb_name) -&gt;<span class="st"> </span>axes_lgnd</a>
<a class="sourceLine" id="cb39-36" data-line-number="36">  </a>
<a class="sourceLine" id="cb39-37" data-line-number="37">  panel_rows[[<span class="dv">4</span>]] &lt;-</a>
<a class="sourceLine" id="cb39-38" data-line-number="38"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(axes_lgnd,</a>
<a class="sourceLine" id="cb39-39" data-line-number="39">              giraddi_color_lgnd,</a>
<a class="sourceLine" id="cb39-40" data-line-number="40">              <span class="dt">nrow =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb39-41" data-line-number="41">              <span class="dt">rel_widths =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb39-42" data-line-number="42">  panel_rows[[<span class="st">"labels"</span>]] &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb39-43" data-line-number="43">  panel_rows[[<span class="st">"nrow"</span>]] &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb39-44" data-line-number="44">  panel_rows[[<span class="st">"rel_heights"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb39-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb39-46" data-line-number="46">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(<span class="dt">what =</span> plot_grid, <span class="dt">args =</span> panel_rows)</a>
<a class="sourceLine" id="cb39-47" data-line-number="47">}</a></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">mnn_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mnn,<span class="st">"MNNPC"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">mds_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mds,<span class="st">"MDS"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span>(<span class="dt">filename =</span> <span class="st">"MG_devel_MNN.eps"</span>,<span class="dt">device =</span> <span class="st">"eps"</span>,<span class="dt">plot =</span> mnn_plots,<span class="dt">path =</span> <span class="st">"~/CorGI_figures/MG_devel"</span>,<span class="dt">width =</span> <span class="dv">6</span>,<span class="dt">height =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span>(<span class="dt">filename =</span> <span class="st">"MG_devel_MDS.eps"</span>,<span class="dt">device =</span> <span class="st">"eps"</span>,<span class="dt">plot =</span> mds_plots,<span class="dt">path =</span> <span class="st">"~/CorGI_figures/MG_devel"</span>,<span class="dt">width =</span> <span class="dv">6</span>,<span class="dt">height =</span> <span class="dv">6</span>)</a></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">mnn_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mnn,<span class="st">"MNNPC"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">mds_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mds,<span class="st">"MDS"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span>(<span class="dt">filename =</span> <span class="st">"MG_devel_MNN_backup.eps"</span>,<span class="dt">device =</span> <span class="st">"eps"</span>,<span class="dt">plot =</span> mnn_plots,<span class="dt">path =</span> <span class="st">"~/CorGI_figures/MG_devel"</span>,<span class="dt">width =</span> <span class="dv">6</span>,<span class="dt">height =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2"></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span>(<span class="dt">filename =</span> <span class="st">"MG_devel_MDS_backup.eps"</span>,<span class="dt">device =</span> <span class="st">"eps"</span>,<span class="dt">plot =</span> mds_plots,<span class="dt">path =</span> <span class="st">"~/CorGI_figures/MG_devel"</span>,<span class="dt">width =</span> <span class="dv">6</span>,<span class="dt">height =</span> <span class="dv">6</span>)</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#pal-et-al-2017-dataset">Pal et al. 2017 dataset</a></li>
      <li><a href="#giraddi-et-al-2018-dataset">Giraddi et al. 2018 dataset</a></li>
      <li><a href="#corgi-feature-selection-on-the-pal-and-giraddi-datasets">CorGI feature selection on the Pal and Giraddi datasets</a></li>
      <li><a href="#curate-the-gene-sets-for-comparison">Curate the gene sets for comparison</a></li>
      <li><a href="#wuidart-et-al-2018-dataset">Wuidart et al. 2018 dataset</a></li>
      <li><a href="#bach-et-al-2017-dataset">Bach et al. 2017 dataset</a></li>
      <li><a href="#reproducing-the-paper-figures">Reproducing the paper figures</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Yutong Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
