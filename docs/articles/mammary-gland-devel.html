<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mammary gland development • corgi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mammary gland development">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">corgi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/corgi.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/embryo-devel.html">Pre-implantation embryo development in human and mouse</a>
    </li>
    <li>
      <a href="../articles/liver-bud.html">Liver bud development</a>
    </li>
    <li>
      <a href="../articles/mammary-gland-devel.html">Mammary gland development</a>
    </li>
    <li>
      <a href="../articles/neurogenesis.html">Neurogenesis in the SVZ</a>
    </li>
    <li>
      <a href="../articles/toy-example.html">Synthetic data example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Mammary gland development</h1>
                        <h4 class="author">Yutong Wang</h4>
            
            <h4 class="date">2019-02-14</h4>
      
      
      <div class="hidden name"><code>mammary-gland-devel.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(corgi)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scmap)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(knitr) <span class="co"># for printing nice looking tables</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2) <span class="co"># for creating pretty plots</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(cowplot) <span class="co"># for creating panel of plots</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(forcats) <span class="co"># for concatenating factors</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scmap) <span class="co"># for the compared feature selection method</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scran)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Matrix)</a></code></pre></div>
<div id="pal-et-al-2017-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#pal-et-al-2017-dataset" class="anchor"></a>Pal et al. 2017 dataset</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE95434&amp;format=file&amp;file=GSE95434%5FGeneCounts%2Etxt%2Egz"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  )</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">pal_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt),<span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">pal_raw[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">pal &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(pal_raw[,<span class="dv">3</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(pal_raw)])))</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(pal)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">pal_entrezGeneID &lt;-<span class="st"> </span>pal_raw[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">pal<span class="op">$</span>cell_type &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(pal) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x,<span class="dt">split =</span> <span class="st">"."</span>,<span class="dt">fixed =</span> T)[[<span class="dv">1</span>]][<span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="dt">pattern =</span> <span class="st">"X"</span>,<span class="dt">replacement =</span> <span class="st">""</span>,<span class="dt">x =</span> x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">  </span>unlist <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2wk"</span>,<span class="st">"4wk"</span>,<span class="st">"10wk"</span>),<span class="dt">ordered =</span> T)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co"># Change the names from entrezgene to mgi_symbol</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">features &lt;-<span class="st"> </span>pal_entrezGeneID</a>
<a class="sourceLine" id="cb2-21" data-line-number="21"></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(biomaRt)</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">mart &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/biomaRt/topics/useMart">useMart</a></span>(<span class="st">"ensembl"</span>, </a>
<a class="sourceLine" id="cb2-24" data-line-number="24">                <span class="dt">dataset =</span> <span class="st">"mmusculus_gene_ensembl"</span>, </a>
<a class="sourceLine" id="cb2-25" data-line-number="25">                <span class="dt">host=</span><span class="st">"www.ensembl.org"</span> )</a>
<a class="sourceLine" id="cb2-26" data-line-number="26"></a>
<a class="sourceLine" id="cb2-27" data-line-number="27">out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/biomaRt/topics/getBM">getBM</a></span>(<span class="dt">attributes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"entrezgene"</span>, <span class="st">"mgi_symbol"</span>), </a>
<a class="sourceLine" id="cb2-28" data-line-number="28">             <span class="dt">values =</span> features, </a>
<a class="sourceLine" id="cb2-29" data-line-number="29">             <span class="dt">mart =</span> mart,</a>
<a class="sourceLine" id="cb2-30" data-line-number="30">             <span class="dt">filters =</span> <span class="st">"entrezgene"</span>)</a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(out)</a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(out)</a>
<a class="sourceLine" id="cb2-33" data-line-number="33">out<span class="op">$</span>is_unique &lt;-<span class="st"> </span><span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out<span class="op">$</span>mgi_symbol)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">out<span class="op">$</span>is_nonempty &lt;-<span class="st"> </span>out<span class="op">$</span>mgi_symbol<span class="op">!=</span><span class="st">""</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">out_unique_nonempty &lt;-<span class="st"> </span>out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(is_unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(is_nonempty)</a>
<a class="sourceLine" id="cb2-36" data-line-number="36"></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co"># Just to be sure</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out_unique_nonempty<span class="op">$</span>mgi_symbol))</a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(out_unique_nonempty<span class="op">$</span>mgi_symbol<span class="op">==</span><span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-42" data-line-number="42"></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co"># Transform to MGI symbols</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"></a>
<a class="sourceLine" id="cb2-45" data-line-number="45">genes_use &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(pal_entrezGeneID <span class="op">%in%</span><span class="st"> </span>out_unique_nonempty<span class="op">$</span>entrezgene)</a>
<a class="sourceLine" id="cb2-46" data-line-number="46"></a>
<a class="sourceLine" id="cb2-47" data-line-number="47">pal &lt;-<span class="st"> </span>pal[genes_use,]</a>
<a class="sourceLine" id="cb2-48" data-line-number="48"></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(pal) &lt;-</a>
<a class="sourceLine" id="cb2-50" data-line-number="50"><span class="st">  </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb2-51" data-line-number="51">    <span class="dt">x =</span> pal_entrezGeneID[genes_use],</a>
<a class="sourceLine" id="cb2-52" data-line-number="52">    <span class="dt">from =</span> out_unique_nonempty<span class="op">$</span>entrezgene,</a>
<a class="sourceLine" id="cb2-53" data-line-number="53">    <span class="dt">to =</span> out_unique_nonempty<span class="op">$</span>mgi_symbol</a>
<a class="sourceLine" id="cb2-54" data-line-number="54">  )</a></code></pre></div>
</div>
<div id="giraddi-et-al-2018-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#giraddi-et-al-2018-dataset" class="anchor"></a>Giraddi et al. 2018 dataset</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE111113&amp;format=file&amp;file=GSE111113%5FTable%5FS1%5FFilterNormal10xExpMatrix%2Etxt%2Egz"</span>))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">giraddi_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.delim2</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt))</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(giraddi_raw))</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(giraddi_raw<span class="op">$</span>gene_id)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(giraddi_raw<span class="op">$</span>X) <span class="co"># the "X" column is where the MGI symbol for the gene names are stored</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co"># remove duplicated MGI symbols</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">giraddi_raw &lt;-<span class="st"> </span>giraddi_raw[<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(giraddi_raw<span class="op">$</span>X),]</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co"># remove empty string names</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">giraddi_raw &lt;-<span class="st"> </span>giraddi_raw[giraddi_raw<span class="op">$</span>X<span class="op">!=</span><span class="st">""</span>,]</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">giraddi &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(giraddi_raw[,<span class="dv">4</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(giraddi_raw)])))</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi) &lt;-<span class="st"> </span>giraddi_raw<span class="op">$</span>X</a>
<a class="sourceLine" id="cb3-18" data-line-number="18"></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">giraddi<span class="op">$</span>cell_type &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(giraddi),<span class="dt">split =</span> <span class="st">"_"</span>),<span class="cf">function</span>(x) x[<span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>()</a>
<a class="sourceLine" id="cb3-24" data-line-number="24"></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(giraddi<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">giraddi<span class="op">$</span>cell_type &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">  <span class="dt">x =</span> giraddi<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">  <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(giraddi<span class="op">$</span>cell_type),</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Adu"</span>, <span class="st">"Adu"</span>, <span class="st">"AduBas"</span>, <span class="st">"E16"</span>, <span class="st">"E18"</span>, <span class="st">"P4"</span>)</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">)</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(pal),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">pal &lt;-<span class="st"> </span>pal[shared_genes,]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">giraddi &lt;-<span class="st"> </span>giraddi[shared_genes,]</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(shared_genes)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; [1] 15314</span></a></code></pre></div>
<p>Filter out cells where less than 5% of the genes are expressed</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;  2wk  4wk 10wk </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;  144  136   66</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">pal &lt;-<span class="st"> </span>pal[,<span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/colSums">colMeans</a></span>(<span class="kw">counts</span>(pal)<span class="op">&gt;</span><span class="dv">0</span>)<span class="op">&gt;</span><span class="fl">0.05</span>]</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  2wk  4wk 10wk </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  142  133   59</span></a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(giraddi<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;    Adu AduBas    E16    E18     P4 </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;   2848    714    650   1008    840</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">giraddi &lt;-<span class="st"> </span>giraddi[,<span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/colSums">colMeans</a></span>(<span class="kw">counts</span>(giraddi)<span class="op">&gt;</span><span class="dv">0</span>)<span class="op">&gt;</span><span class="fl">0.05</span>]</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(giraddi<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;    Adu AduBas    E16    E18     P4 </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   2769    714    650   1007    835</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># plyr::mapvalues(</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#   x = pal$cell_type,</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#   from = c("2wk","4wk","10wk"),</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#   to = c("2wk","4wk","Adu")</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># ) -&gt;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#   pal$cell_type</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">batches &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">Pal =</span> pal)</a></code></pre></div>
</div>
<div id="corgi-feature-selection-on-the-pal-and-giraddi-datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#corgi-feature-selection-on-the-pal-and-giraddi-datasets" class="anchor"></a>CorGI feature selection on the Pal and Giraddi datasets</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">corgi_output_MG_devel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_corgi.html">run_corgi</a></span>(<span class="kw">counts</span>(pal),<span class="kw">counts</span>(giraddi))</a></code></pre></div>
</div>
<div id="curate-the-gene-sets-for-comparison" class="section level1">
<h1 class="hasAnchor">
<a href="#curate-the-gene-sets-for-comparison" class="anchor"></a>Curate the gene sets for comparison</h1>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">rowData</span>(pal)<span class="op">$</span>feature_symbols &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(pal)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">rowData</span>(giraddi)<span class="op">$</span>feature_symbols &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">corgi_gene_set &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_top_corgi_genes.html">select_top_corgi_genes</a></span>(corgi_output_MG_devel,<span class="dt">n =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"># mbn = abbrev for multiBatchNorm</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">mbn_out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/multiBatchNorm">multiBatchNorm</a></span>(pal,giraddi) </a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">HDG_ranking &lt;-<span class="st"> </span><span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="kw">rowData</span>(sce)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  sce &lt;-<span class="st"> </span>scmap<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/scmap/topics/selectFeatures">selectFeatures</a></span>(sce)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(<span class="kw">rowData</span>(sce)[[<span class="st">"scmap_scores"</span>]],<span class="dt">decreasing =</span> T,<span class="dt">na.last =</span> T)])</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">n &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(corgi_gene_set)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">gene_sets &lt;-<span class="st"> </span><span class="kw">get_compared_gene_sets</span>(</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  <span class="dt">batch1_top_genes =</span> <span class="kw">HDG_ranking</span>(mbn_out[[<span class="dv">1</span>]]),</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  <span class="dt">batch1_name =</span> <span class="st">"HDG(Pal)"</span>,</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="dt">batch2_top_genes =</span> <span class="kw">HDG_ranking</span>(mbn_out[[<span class="dv">2</span>]]), </a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  <span class="dt">batch2_name =</span> <span class="st">"HDG(Giraddi)"</span>,</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  <span class="dt">desired_size =</span> n)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; [1] 559</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; [1] 558</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">gene_sets[[<span class="st">"CorGI"</span>]] &lt;-<span class="st"> </span>corgi_gene_set</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">gene_sets &lt;-<span class="st"> </span>gene_sets[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)]</a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(gene_sets, length)</a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; $CorGI</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt; $`HDG(Pal)`</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; $`HDG(Giraddi)`</span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt; $Union</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt; [1] 1000</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="co">#&gt; $Intersection</span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38"><span class="co">#&gt; [1] 1000</span></a></code></pre></div>
<p>Subsample the Giraddi dataset for visualization</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">sample_cells &lt;-<span class="st"> </span><span class="cf">function</span>(object, n){</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(object[,<span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(object),n)])</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">giraddi &lt;-<span class="st"> </span><span class="kw">sample_cells</span>(giraddi,<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">cell_type &lt;-<span class="st"> </span>forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_c.html">fct_c</a></span>(giraddi<span class="op">$</span>cell_type,pal<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">batch &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Giraddi"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(giraddi)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Pal"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(pal)))</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">comb &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw">counts</span>(giraddi),<span class="kw">counts</span>(pal))</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">corgi_gene_set &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_top_corgi_genes.html">select_top_corgi_genes</a></span>(corgi_output_MG_devel,<span class="dt">n =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">D &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cor</a></span>(comb[corgi_gene_set,],<span class="dt">method =</span> <span class="st">"spearman"</span>))<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">mds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cmdscale">cmdscale</a></span>(D,<span class="dt">k=</span><span class="dv">2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">my_shape_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">16</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">my_color_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#000000"</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">qplot &lt;-<span class="st"> </span><span class="cf">function</span>(...){</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(...) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="dt">values =</span> my_color_palette) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span>(<span class="dt">values =</span> my_shape_palette)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(mds[,<span class="dv">1</span>],mds[,<span class="dv">2</span>],<span class="dt">color =</span> cell_type,<span class="dt">shape =</span> batch)</a></code></pre></div>
<p><img src="mammary-gland-devel_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div id="wuidart-et-al-2018-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#wuidart-et-al-2018-dataset" class="anchor"></a>Wuidart et al. 2018 dataset</h1>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE110nnn/GSE110351/suppl/GSE110351_MG_EMP_LC_BC_raw_counts.csv.gz"</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  )</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">wuidart_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt))</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">wuidart_raw[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">wuidart &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(wuidart_raw[,<span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(wuidart_raw)])))</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co"># First column of gse is the gene names</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) &lt;-<span class="st"> </span>wuidart_raw[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co"># Remove the spike-ins</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"></a>
<a class="sourceLine" id="cb15-13" data-line-number="13">wuidart &lt;-<span class="st"> </span>wuidart[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="st">"ENSMUSG"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart)),]</a>
<a class="sourceLine" id="cb15-14" data-line-number="14"></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co"># Let us convert ENSEMBL to MGI symbols for the genes</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart))</a>
<a class="sourceLine" id="cb15-18" data-line-number="18"></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co"># We need to remove the dots</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"></a>
<a class="sourceLine" id="cb15-22" data-line-number="22">f &lt;-<span class="st"> </span><span class="cf">function</span>(x){ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x,<span class="dt">split =</span> <span class="st">"."</span>,<span class="dt">fixed =</span> T)[[<span class="dv">1</span>]][<span class="dv">1</span>] }</a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart), f))</a>
<a class="sourceLine" id="cb15-24" data-line-number="24"></a>
<a class="sourceLine" id="cb15-25" data-line-number="25"><span class="co"># Does this cause any duplicates?</span></a>
<a class="sourceLine" id="cb15-26" data-line-number="26"></a>
<a class="sourceLine" id="cb15-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart)))</a>
<a class="sourceLine" id="cb15-28" data-line-number="28"></a>
<a class="sourceLine" id="cb15-29" data-line-number="29"></a>
<a class="sourceLine" id="cb15-30" data-line-number="30"><span class="co"># Get the MGI symbols</span></a>
<a class="sourceLine" id="cb15-31" data-line-number="31">out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/biomaRt/topics/getBM">getBM</a></span>(<span class="dt">attributes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ensembl_gene_id"</span>, <span class="st">"mgi_symbol"</span>), </a>
<a class="sourceLine" id="cb15-32" data-line-number="32">             <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart), </a>
<a class="sourceLine" id="cb15-33" data-line-number="33">             <span class="dt">mart =</span> mart,</a>
<a class="sourceLine" id="cb15-34" data-line-number="34">             <span class="dt">filters =</span> <span class="st">"ensembl_gene_id"</span>)</a>
<a class="sourceLine" id="cb15-35" data-line-number="35"></a>
<a class="sourceLine" id="cb15-36" data-line-number="36"><span class="co"># Remove duplicates</span></a>
<a class="sourceLine" id="cb15-37" data-line-number="37">out &lt;-<span class="st"> </span>out[(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out<span class="op">$</span>ensembl_gene_id)) <span class="op">&amp;</span><span class="st"> </span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(out<span class="op">$</span>mgi_symbol)),]</a>
<a class="sourceLine" id="cb15-38" data-line-number="38"></a>
<a class="sourceLine" id="cb15-39" data-line-number="39">wuidart &lt;-<span class="st"> </span>wuidart[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) <span class="op">%in%</span><span class="st"> </span>out<span class="op">$</span>ensembl_gene_id,]</a>
<a class="sourceLine" id="cb15-40" data-line-number="40"></a>
<a class="sourceLine" id="cb15-41" data-line-number="41"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart) &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(wuidart),</a>
<a class="sourceLine" id="cb15-42" data-line-number="42">                                     <span class="dt">from =</span> out<span class="op">$</span>ensembl_gene_id,</a>
<a class="sourceLine" id="cb15-43" data-line-number="43">                                     <span class="dt">to =</span> out<span class="op">$</span>mgi_symbol)</a>
<a class="sourceLine" id="cb15-44" data-line-number="44"></a>
<a class="sourceLine" id="cb15-45" data-line-number="45"><span class="co"># Now we need to get the metadata</span></a>
<a class="sourceLine" id="cb15-46" data-line-number="46"></a>
<a class="sourceLine" id="cb15-47" data-line-number="47"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(GEOquery)</a>
<a class="sourceLine" id="cb15-48" data-line-number="48">gse &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/GEOquery/topics/getGEO">getGEO</a></span>(<span class="st">"GSE110351"</span>)</a>
<a class="sourceLine" id="cb15-49" data-line-number="49">md_raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(gse<span class="op">$</span>GSE110351_series_matrix.txt.gz<span class="op">$</span>title)</a>
<a class="sourceLine" id="cb15-50" data-line-number="50"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(md_raw) <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(wuidart)</a>
<a class="sourceLine" id="cb15-51" data-line-number="51">md &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">raw =</span> md_raw,<span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb15-52" data-line-number="52"></a>
<a class="sourceLine" id="cb15-53" data-line-number="53"></a>
<a class="sourceLine" id="cb15-54" data-line-number="54"><span class="co"># The cell barcodes are the last 17 characters (including the dash)</span></a>
<a class="sourceLine" id="cb15-55" data-line-number="55"></a>
<a class="sourceLine" id="cb15-56" data-line-number="56">md<span class="op">$</span>raw[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb15-57" data-line-number="57">substrRight &lt;-<span class="st"> </span><span class="cf">function</span>(x, n){</a>
<a class="sourceLine" id="cb15-58" data-line-number="58">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>(x, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(x)<span class="op">-</span>n<span class="op">+</span><span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(x))</a>
<a class="sourceLine" id="cb15-59" data-line-number="59">}</a>
<a class="sourceLine" id="cb15-60" data-line-number="60">md<span class="op">$</span>barcodes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(md<span class="op">$</span>raw,<span class="cf">function</span>(x) <span class="kw">substrRight</span>(x,<span class="dv">17</span>)))</a>
<a class="sourceLine" id="cb15-61" data-line-number="61">md<span class="op">$</span>barcodes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="st">"-"</span>,<span class="st">"."</span>,md<span class="op">$</span>barcodes)</a>
<a class="sourceLine" id="cb15-62" data-line-number="62">md &lt;-<span class="st"> </span>md[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(md<span class="op">$</span>barcodes),]</a>
<a class="sourceLine" id="cb15-63" data-line-number="63">wuidart &lt;-<span class="st"> </span>wuidart[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(wuidart))]</a>
<a class="sourceLine" id="cb15-64" data-line-number="64"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(wuidart) <span class="op">==</span><span class="st"> </span>md<span class="op">$</span>barcodes)</a>
<a class="sourceLine" id="cb15-65" data-line-number="65"></a>
<a class="sourceLine" id="cb15-66" data-line-number="66">removeRight &lt;-<span class="st"> </span><span class="cf">function</span>(x, n){</a>
<a class="sourceLine" id="cb15-67" data-line-number="67">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substr">substr</a></span>(x, <span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(x)<span class="op">-</span>n)</a>
<a class="sourceLine" id="cb15-68" data-line-number="68">}</a>
<a class="sourceLine" id="cb15-69" data-line-number="69">md<span class="op">$</span>raw &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(md<span class="op">$</span>raw,<span class="cf">function</span>(x) <span class="kw">removeRight</span>(x,<span class="dv">18</span>)))</a>
<a class="sourceLine" id="cb15-70" data-line-number="70"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(md<span class="op">$</span>raw)</a>
<a class="sourceLine" id="cb15-71" data-line-number="71"></a>
<a class="sourceLine" id="cb15-72" data-line-number="72">md<span class="op">$</span>is_single_cell &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Single"</span>,md<span class="op">$</span>raw)</a>
<a class="sourceLine" id="cb15-73" data-line-number="73">md<span class="op">$</span>cell_type &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb15-74" data-line-number="74"><span class="cf">for</span>(ct <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Basal"</span>,<span class="st">"Luminal"</span>,<span class="st">"Embryonal Progenitor"</span>)){</a>
<a class="sourceLine" id="cb15-75" data-line-number="75">  md<span class="op">$</span>cell_type[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(ct,md<span class="op">$</span>raw)] &lt;-<span class="st"> </span>ct</a>
<a class="sourceLine" id="cb15-76" data-line-number="76">}</a>
<a class="sourceLine" id="cb15-77" data-line-number="77"></a>
<a class="sourceLine" id="cb15-78" data-line-number="78">wuidart<span class="op">$</span>is_single_cell &lt;-<span class="st"> </span>md<span class="op">$</span>is_single_cell</a>
<a class="sourceLine" id="cb15-79" data-line-number="79">wuidart<span class="op">$</span>cell_type &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(md<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb15-80" data-line-number="80">wuidart &lt;-<span class="st"> </span>wuidart[,wuidart<span class="op">$</span>is_single_cell]</a>
<a class="sourceLine" id="cb15-81" data-line-number="81"></a>
<a class="sourceLine" id="cb15-82" data-line-number="82"><span class="co"># Did we miss anything?</span></a>
<a class="sourceLine" id="cb15-83" data-line-number="83"></a>
<a class="sourceLine" id="cb15-84" data-line-number="84"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(wuidart<span class="op">$</span>cell_type))</a>
<a class="sourceLine" id="cb15-85" data-line-number="85">plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb15-86" data-line-number="86">  <span class="dt">x =</span> wuidart<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb15-87" data-line-number="87">  <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Basal"</span>,<span class="st">"Luminal"</span>,<span class="st">"Embryonal Progenitor"</span>),</a>
<a class="sourceLine" id="cb15-88" data-line-number="88">  <span class="dt">to =</span>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Basal"</span>,<span class="st">"Luminal"</span>,<span class="st">"EMP"</span>)</a>
<a class="sourceLine" id="cb15-89" data-line-number="89">) -&gt;<span class="st"> </span>wuidart<span class="op">$</span>cell_type</a></code></pre></div>
</div>
<div id="bach-et-al-2017-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#bach-et-al-2017-dataset" class="anchor"></a>Bach et al. 2017 dataset</h1>
<p>Data from <a href="https://www.nature.com/articles/s41467-017-02001-5">Bach et al., 2017</a></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">bach_np1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/externalFormats">readMM</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/samples/GSM2834nnn/GSM2834498/suppl/GSM2834498_NP_1_matrix.mtx.gz"</span>)))</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(bach_np1)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">bach_np2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/externalFormats">readMM</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/samples/GSM2834nnn/GSM2834499/suppl/GSM2834499_NP_2_matrix.mtx.gz"</span>)))</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(bach_np2)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE106nnn/GSE106273/suppl/GSE106273_combined_genes.tsv.gz"</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="st">  </span>url <span class="op">%&gt;%</span><span class="st"> </span>gzcon <span class="op">%&gt;%</span><span class="st"> </span>readLines <span class="op">%&gt;%</span><span class="st"> </span>textConnection <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(<span class="dt">stringsAsFactors =</span> F) -&gt;</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="st">  </span>bach_genes</a>
<a class="sourceLine" id="cb16-10" data-line-number="10"></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">bach_genes[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(bach_np1) &lt;-<span class="st"> </span>bach_genes[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(bach_np2) &lt;-<span class="st"> </span>bach_genes[,<span class="dv">2</span>]</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">bach_np1 &lt;-<span class="st"> </span><span class="kw">sample_cells</span>(bach_np1,<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">bach_np2 &lt;-<span class="st"> </span><span class="kw">sample_cells</span>(bach_np2,<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">bach_np &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(bach_np1,bach_np2)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">bach_np &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">counts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(bach_np)))</a></code></pre></div>
<p>From <a href="https://www.nature.com/articles/s41467-017-02001-5">Bach et al., 2017</a>: “Tissue from NP females was harvested at 8 weeks of age.”</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">bach_np<span class="op">$</span>cell_type &lt;-<span class="st"> "8wk"</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">bach_np<span class="op">$</span>cell_type &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(bach_np<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">batches[[<span class="st">"Bach_NP"</span>]] &lt;-<span class="st"> </span>bach_np</a></code></pre></div>
</div>
<div id="reproducing-the-paper-figures" class="section level1">
<h1 class="hasAnchor">
<a href="#reproducing-the-paper-figures" class="anchor"></a>Reproducing the paper figures</h1>
<p>For each batch, for each gene_set, compute dimensionality reductions, i.e., MNNPC and Spearman rho mds</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Spearman rho multidimensional scaling</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="dt">X =</span> batches, <span class="co"># for each batch</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="dt">FUN =</span> <span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce))</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    combined &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw">counts</span>(giraddi[shared_genes,]),</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">                      <span class="kw">counts</span>(sce[shared_genes,]))</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">      <span class="dt">X =</span> gene_sets, <span class="co"># for each gene_sets</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10">      <span class="dt">FUN =</span> <span class="cf">function</span>(gene_set) {</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">        gene_set &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(gene_set, shared_genes)</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">        mds &lt;-<span class="st"> </span><span class="kw">spearman_rho_mds</span>(combined[gene_set, ])</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(mds)</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">      }</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">    )</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">  }) -&gt;<span class="st"> </span>embeddings_mds</a>
<a class="sourceLine" id="cb19-17" data-line-number="17"></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co"># Mutual-nearest-neighbor PCA</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb19-20" data-line-number="20">  <span class="dt">X =</span> batches,</a>
<a class="sourceLine" id="cb19-21" data-line-number="21">  <span class="dt">FUN =</span> <span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb19-22" data-line-number="22">    shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(giraddi),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce))</a>
<a class="sourceLine" id="cb19-23" data-line-number="23">    </a>
<a class="sourceLine" id="cb19-24" data-line-number="24">    mbn_out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/multiBatchNorm">multiBatchNorm</a></span>(giraddi[shared_genes,],</a>
<a class="sourceLine" id="cb19-25" data-line-number="25">                              sce[shared_genes,])</a>
<a class="sourceLine" id="cb19-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb19-27" data-line-number="27">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb19-28" data-line-number="28">      <span class="dt">X =</span> gene_sets,</a>
<a class="sourceLine" id="cb19-29" data-line-number="29">      <span class="dt">FUN =</span> <span class="cf">function</span>(gene_set) {</a>
<a class="sourceLine" id="cb19-30" data-line-number="30">        gene_set &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(gene_set, shared_genes)</a>
<a class="sourceLine" id="cb19-31" data-line-number="31">        mnn.out &lt;-</a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="st">          </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/mnnCorrect">mnnCorrect</a></span>(<span class="kw">logcounts</span>(mbn_out[[<span class="dv">1</span>]][gene_set, ]),</a>
<a class="sourceLine" id="cb19-33" data-line-number="33">                     <span class="kw">logcounts</span>(mbn_out[[<span class="dv">2</span>]][gene_set, ]))</a>
<a class="sourceLine" id="cb19-34" data-line-number="34">        t.mnn &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(cbind, mnn.out<span class="op">$</span>corrected)))</a>
<a class="sourceLine" id="cb19-35" data-line-number="35">        <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/prcomp">prcomp</a></span>(t.mnn, <span class="dt">rank =</span> <span class="dv">2</span>)<span class="op">$</span>x</a>
<a class="sourceLine" id="cb19-36" data-line-number="36">      }</a>
<a class="sourceLine" id="cb19-37" data-line-number="37">    )</a>
<a class="sourceLine" id="cb19-38" data-line-number="38">  }) -&gt;<span class="st"> </span>embeddings_mnn</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">get_scatterplots &lt;-<span class="st"> </span><span class="cf">function</span>(embeddings, batch, cell_type){</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">X =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(gene_sets),</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">         <span class="dt">FUN =</span> <span class="cf">function</span>(gs_name) {</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">           emb &lt;-<span class="st"> </span>embeddings[[gs_name]]</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">           <span class="kw">plot_dimensionality_reduction</span>(emb, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(batch), cell_type) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">             </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(gs_name, <span class="st">", "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(corgi<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/corgi/topics/batch_mixing">batch_mixing</a></span>(emb, batch), <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">         })</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">}</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">color_palettes &lt;-</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">Pal =</span> my_color_palette[<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>],</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">       <span class="dt">Wuidart =</span> my_color_palette[<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>],</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">       <span class="dt">Bach_NP =</span> my_color_palette[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">6</span>)])</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">get_panel_for_dr &lt;-<span class="st"> </span><span class="cf">function</span>(embeddings_dr, emb_name,gene_sets_use){</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">    <span class="dt">X =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(batches),</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">    <span class="dt">FUN =</span> <span class="cf">function</span>(batch_name) {</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">      sce &lt;-<span class="st"> </span>batches[[batch_name]]</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">      cell_type &lt;-<span class="st"> </span>forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_c.html">fct_c</a></span>(giraddi<span class="op">$</span>cell_type,</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">                                  sce<span class="op">$</span>cell_type)</a>
<a class="sourceLine" id="cb21-14" data-line-number="14">      batch &lt;-</a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="st">        </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Giraddi"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(giraddi)), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(batch_name, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(sce)))</a>
<a class="sourceLine" id="cb21-16" data-line-number="16">      batch &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(batch,<span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(batch))</a>
<a class="sourceLine" id="cb21-17" data-line-number="17">      <span class="kw">get_scatterplots</span>(embeddings_dr[[batch_name]],</a>
<a class="sourceLine" id="cb21-18" data-line-number="18">                       <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(batch),</a>
<a class="sourceLine" id="cb21-19" data-line-number="19">                       cell_type) -&gt;<span class="st"> </span>plts</a>
<a class="sourceLine" id="cb21-20" data-line-number="20">      plts &lt;-<span class="st"> </span>plts[gene_sets_use]</a>
<a class="sourceLine" id="cb21-21" data-line-number="21">      <span class="kw">get_color_legend</span>(cell_type[batch <span class="op">==</span><span class="st"> </span>batch_name],</a>
<a class="sourceLine" id="cb21-22" data-line-number="22">                       color_palettes[[batch_name]],</a>
<a class="sourceLine" id="cb21-23" data-line-number="23">                       <span class="dt">legend.title =</span> batch_name) -&gt;<span class="st"> </span>plts[[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(plts)<span class="op">+</span><span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb21-24" data-line-number="24">      plts[[<span class="st">"nrow"</span>]] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb21-25" data-line-number="25">      plts[[<span class="st">"rel_widths"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">2</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(gene_sets_use)), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-26" data-line-number="26">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(<span class="dt">what =</span> plot_grid, <span class="dt">args =</span> plts)</a>
<a class="sourceLine" id="cb21-27" data-line-number="27">      </a>
<a class="sourceLine" id="cb21-28" data-line-number="28">    }</a>
<a class="sourceLine" id="cb21-29" data-line-number="29">  ) -&gt;<span class="st"> </span>panel_rows</a>
<a class="sourceLine" id="cb21-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb21-31" data-line-number="31">  <span class="kw">get_color_legend</span>(cell_type[batch <span class="op">==</span><span class="st"> "Giraddi"</span>],</a>
<a class="sourceLine" id="cb21-32" data-line-number="32">                   my_color_palette,</a>
<a class="sourceLine" id="cb21-33" data-line-number="33">                   <span class="dt">legend.title =</span> <span class="st">"Giraddi"</span>,</a>
<a class="sourceLine" id="cb21-34" data-line-number="34">                   <span class="dt">legend.position =</span> <span class="st">"bottom"</span>,</a>
<a class="sourceLine" id="cb21-35" data-line-number="35">                   <span class="dt">shape =</span> <span class="dv">1</span>) -&gt;</a>
<a class="sourceLine" id="cb21-36" data-line-number="36"><span class="st">    </span>giraddi_color_lgnd</a>
<a class="sourceLine" id="cb21-37" data-line-number="37">  <span class="kw"><a href="../reference/get_axes_legend.html">get_axes_legend</a></span>(emb_name) -&gt;<span class="st"> </span>axes_lgnd</a>
<a class="sourceLine" id="cb21-38" data-line-number="38">  </a>
<a class="sourceLine" id="cb21-39" data-line-number="39">  panel_rows[[<span class="dv">4</span>]] &lt;-</a>
<a class="sourceLine" id="cb21-40" data-line-number="40"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(axes_lgnd,</a>
<a class="sourceLine" id="cb21-41" data-line-number="41">              giraddi_color_lgnd,</a>
<a class="sourceLine" id="cb21-42" data-line-number="42">              <span class="dt">nrow =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-43" data-line-number="43">              <span class="dt">rel_widths =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb21-44" data-line-number="44">  panel_rows[[<span class="st">"labels"</span>]] &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb21-45" data-line-number="45">  panel_rows[[<span class="st">"nrow"</span>]] &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb21-46" data-line-number="46">  panel_rows[[<span class="st">"rel_heights"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-47" data-line-number="47">  </a>
<a class="sourceLine" id="cb21-48" data-line-number="48">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(<span class="dt">what =</span> plot_grid, <span class="dt">args =</span> panel_rows)</a>
<a class="sourceLine" id="cb21-49" data-line-number="49">}</a></code></pre></div>
<p>Main plots</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">mnn_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mnn,<span class="st">"MNNPC"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">mds_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mds,<span class="st">"MDS"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<p>Multidimensional scaling plots</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">mds_plots</a></code></pre></div>
<p><img src="mammary-gland-devel_files/figure-html/unnamed-chunk-35-1.png" width="576"></p>
<p>Mutual-nearest-neighbor PCA plot</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">mnn_plots</a></code></pre></div>
<p><img src="mammary-gland-devel_files/figure-html/unnamed-chunk-36-1.png" width="576"></p>
<p>Supplementary plots</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">mnn_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mnn,<span class="st">"MNNPC"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">mds_plots &lt;-<span class="st"> </span><span class="kw">get_panel_for_dr</span>(embeddings_mds,<span class="st">"MDS"</span>,<span class="dt">gene_sets_use =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<p>Multidimensional scaling plots</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">mds_plots</a></code></pre></div>
<p><img src="mammary-gland-devel_files/figure-html/unnamed-chunk-39-1.png" width="576"></p>
<p>Mutual-nearest-neighbor PCA plot</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">mnn_plots</a></code></pre></div>
<p><img src="mammary-gland-devel_files/figure-html/unnamed-chunk-40-1.png" width="576"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#pal-et-al-2017-dataset">Pal et al. 2017 dataset</a></li>
      <li><a href="#giraddi-et-al-2018-dataset">Giraddi et al. 2018 dataset</a></li>
      <li><a href="#corgi-feature-selection-on-the-pal-and-giraddi-datasets">CorGI feature selection on the Pal and Giraddi datasets</a></li>
      <li><a href="#curate-the-gene-sets-for-comparison">Curate the gene sets for comparison</a></li>
      <li><a href="#wuidart-et-al-2018-dataset">Wuidart et al. 2018 dataset</a></li>
      <li><a href="#bach-et-al-2017-dataset">Bach et al. 2017 dataset</a></li>
      <li><a href="#reproducing-the-paper-figures">Reproducing the paper figures</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Yutong Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
