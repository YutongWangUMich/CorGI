<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liver bud development â€¢ corgi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Liver bud development">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">corgi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/corgi.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/embryo-devel.html">Pre-implantation embryo development in human and mouse</a>
    </li>
    <li>
      <a href="../articles/liver-bud.html">Liver bud development</a>
    </li>
    <li>
      <a href="../articles/mammary-gland-devel.html">Mammary gland development</a>
    </li>
    <li>
      <a href="../articles/neurogenesis.html">Neurogenesis in the SVZ</a>
    </li>
    <li>
      <a href="../articles/toy-example.html">Synthetic data example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/YutongWangUMich/corgi">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Liver bud development</h1>
                        <h4 class="author">Yutong Wang</h4>
            
            <h4 class="date">2019-02-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/YutongWangUMich/corgi/blob/master/vignettes/liver-bud.Rmd"><code>vignettes/liver-bud.Rmd</code></a></small>
      <div class="hidden name"><code>liver-bud.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(corgi) </a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(knitr) <span class="co"># for printing nice looking tables</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2) <span class="co"># for creating pretty plots</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(cowplot) <span class="co"># for creating panel of plots</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr) <span class="co"># for pretty code</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(forcats) <span class="co"># for concatenating factors</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scmap) <span class="co"># for the compared feature selection method</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scran)</a></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>We analyze the liver bud dataset from <a href="https://www.nature.com/articles/nature22796">Camp et al 2017</a>.</p>
<p>Everything below is totally self-contained: you can copy-paste word for word and it will run. The single-line code block in section <em>CorGI unsupervised feature selection</em> takes one hour to run. Everything else in total takes under one minute.</p>
<p>This vignette contains long sections headed by <em>Reproducing paper figures</em>. These sections are not necessary for using CorGI. To see a more user-friendly pipeline for applying CorGI to your research, see <a href="https://yutongwangumich.github.io/corgi/articles/corgi.html">Get Started</a>.</p>
<p>The section under <em>Exploratory analysis</em> (and in particular, normalization by making the library sizes comparable across batches) is also not necessary to use CorGI. In fact, it makes no difference whether the counts are integers, log-transformed, TPM, FPKM, etc.</p>
</div>
<div id="data-cleaning" class="section level1">
<h1 class="hasAnchor">
<a href="#data-cleaning" class="anchor"></a>Data cleaning</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE81nnn/GSE81252/suppl/GSE81252_data.cast.log2.liverbud.csv.gz"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  )</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">liverbud &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt))</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># The first three columns are metadata while the rest are the log2 expressions</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">metadata &lt;-<span class="st"> </span>liverbud[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">counts &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(liverbud[,<span class="dv">4</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(liverbud)]))</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(counts) &lt;-<span class="st"> </span>metadata<span class="op">$</span>cell_id</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(metadata) &lt;-<span class="st"> </span>metadata<span class="op">$</span>cell_id</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co"># The column "assignment_LB" contains both the lineage and batch information</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co"># IN = input cell lines, LB = liver bud</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">metadata<span class="op">$</span>LB_status &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">X =</span> metadata<span class="op">$</span>assignment_LB,</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">                <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(<span class="dt">test =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"LB"</span>,x),<span class="dt">yes =</span> <span class="st">"Liver_bud"</span>,<span class="dt">no =</span> <span class="st">"Input"</span>)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">                ))</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co"># EC = endothelial cells, HE = hepatic endoderm, MC = mesenchymal cells</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21">metadata<span class="op">$</span>lineage &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dt">X =</span> metadata<span class="op">$</span>assignment_LB,</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">           <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(x),<span class="dt">split =</span> <span class="st">"-"</span>,<span class="dt">fixed =</span> T)[[<span class="dv">1</span>]][<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">    ))</a>
<a class="sourceLine" id="cb2-26" data-line-number="26"></a>
<a class="sourceLine" id="cb2-27" data-line-number="27">plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(<span class="dt">x =</span> metadata<span class="op">$</span>lineage,</a>
<a class="sourceLine" id="cb2-28" data-line-number="28">                <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(metadata<span class="op">$</span>lineage),</a>
<a class="sourceLine" id="cb2-29" data-line-number="29">                <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Endothelial"</span>,<span class="st">"Hepatic"</span>,<span class="st">"Mesenchymal"</span>)) -&gt;<span class="st"> </span>metadata<span class="op">$</span>lineage</a>
<a class="sourceLine" id="cb2-30" data-line-number="30"></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"></a>
<a class="sourceLine" id="cb2-32" data-line-number="32">camp &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">logcounts =</span> counts),<span class="dt">colData =</span> metadata)</a></code></pre></div>
</div>
<div id="exploratory-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#exploratory-analysis" class="anchor"></a>Exploratory analysis</h1>
<p>Convert to <code>SingleCellExperiment</code> objects</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">IN &lt;-<span class="st"> </span>camp[,camp<span class="op">$</span>LB_status<span class="op">==</span><span class="st">"Input"</span>]</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">LB &lt;-<span class="st"> </span>camp[,camp<span class="op">$</span>LB_status<span class="op">==</span><span class="st">"Liver_bud"</span>]</a></code></pre></div>
<p>Normalization by making the library sizes comparable across batches</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">out &lt;-<span class="st"> </span>scran<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/multiBatchNorm">multiBatchNorm</a></span>(IN,LB,<span class="dt">assay.type =</span> <span class="st">"logcounts"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">IN_norm &lt;-<span class="st"> </span>out[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">LB_norm &lt;-<span class="st"> </span>out[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(out)</a></code></pre></div>
<p>Combine the datasets</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">combined &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(IN,LB)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">combined<span class="op">$</span>batch &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Input"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(IN)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Liver bud"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(LB)))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">lineage &lt;-<span class="st"> </span>combined<span class="op">$</span>lineage</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">batch &lt;-<span class="st"> </span>combined<span class="op">$</span>batch</a></code></pre></div>
<p>Wrapper around qplot for visualization</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">my_color_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#999999"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">my_shape_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">16</span>,<span class="dv">1</span>,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">qplot &lt;-<span class="st"> </span><span class="cf">function</span>(...){</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(...) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="dt">values =</span> my_color_palette) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span>(<span class="dt">values =</span> my_shape_palette)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">}</a></code></pre></div>
<div id="pc-plot-using-all-the-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#pc-plot-using-all-the-genes" class="anchor"></a>PC plot using all the genes</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">pc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/prcomp">prcomp</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw">logcounts</span>(combined)),<span class="dt">rank. =</span> <span class="dv">2</span>)<span class="op">$</span>x</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(pc[,<span class="dv">1</span>],pc[,<span class="dv">2</span>],<span class="dt">color =</span> lineage,<span class="dt">shape =</span> batch)</a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
</div>
<div id="corgi-unsupervised-feature-selection" class="section level1">
<h1 class="hasAnchor">
<a href="#corgi-unsupervised-feature-selection" class="anchor"></a>CorGI unsupervised feature selection</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">corgi_output_liver_bud &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_corgi.html">run_corgi</a></span>(<span class="kw">logcounts</span>(IN),<span class="kw">logcounts</span>(LB))</a></code></pre></div>
<div id="selecting-the-top-corgi-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-the-top-corgi-genes" class="anchor"></a>Selecting the top CorGI genes</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">corgi_gene_set &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">union</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw"><a href="../reference/select_top_corgi_genes.html">select_top_corgi_genes</a></span>(corgi_output_liver_bud,<span class="dv">250</span>,<span class="dt">SVG_use =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="kw"><a href="../reference/select_top_corgi_genes.html">select_top_corgi_genes</a></span>(corgi_output_liver_bud,<span class="dv">250</span>,<span class="dt">SVG_use =</span> <span class="dv">3</span>))</a></code></pre></div>
</div>
<div id="pca-on-corgi-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#pca-on-corgi-genes" class="anchor"></a>PCA on CorGI genes</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">pc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/prcomp">prcomp</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw">logcounts</span>(combined)[corgi_gene_set,]),<span class="dt">rank. =</span> <span class="dv">2</span>)<span class="op">$</span>x</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(pc[,<span class="dv">1</span>],pc[,<span class="dv">2</span>],<span class="dt">color =</span> lineage,<span class="dt">shape =</span> batch)</a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
</div>
<div id="reproducing-paper-figures" class="section level1">
<h1 class="hasAnchor">
<a href="#reproducing-paper-figures" class="anchor"></a>Reproducing paper figures</h1>
<p>Gene sets to compare CorGI against</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">HDG_ranking &lt;-<span class="st"> </span><span class="cf">function</span>(sce){</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="kw">rowData</span>(sce)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  sce &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scmap/topics/selectFeatures">selectFeatures</a></span>(sce,<span class="dt">suppress_plot =</span> F)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(sce)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(<span class="kw">rowData</span>(sce)[[<span class="st">"scmap_scores"</span>]],<span class="dt">decreasing =</span> T,<span class="dt">na.last =</span> T)])</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">gene_sets &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_compared_gene_sets.html">get_compared_gene_sets</a></span>(</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  <span class="dt">batch1_top_genes =</span> <span class="kw">HDG_ranking</span>(IN),</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  <span class="dt">batch1_name =</span> <span class="st">"HDG(Input)"</span>,</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  <span class="dt">batch2_top_genes =</span> <span class="kw">HDG_ranking</span>(LB),</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  <span class="dt">batch2_name =</span> <span class="st">"HDG(Liver bud)"</span>,</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="dt">desired_size =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(corgi_gene_set)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">)</a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-15-1.png" width="700"><img src="liver-bud_files/figure-html/unnamed-chunk-15-2.png" width="700"></p>
<pre><code>#&gt; $x
#&gt; [1] 1065
#&gt; 
#&gt; $y
#&gt; [1] 1064

gene_sets[["CorGI"]] &lt;- corgi_gene_set

names(gene_sets)
#&gt; [1] "HDG(Input)"     "HDG(Liver bud)" "Union"          "Intersection"  
#&gt; [5] "CorGI"</code></pre>
<p>Reorder the gene sets</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">gene_sets &lt;-<span class="st"> </span>gene_sets[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)]</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(gene_sets, length)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#&gt; $CorGI</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; $`HDG(Input)`</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; $`HDG(Liver bud)`</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; $Union</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; $Intersection</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; [1] 500</span></a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">embeddings_mds &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="dt">X =</span> gene_sets,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    <span class="dt">FUN =</span> <span class="cf">function</span>(gene_set) {</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">      D &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>((<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cor</a></span>(<span class="kw">logcounts</span>(combined)[gene_set, ], <span class="dt">method =</span> <span class="st">"spearman"</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cmdscale">cmdscale</a></span>(D, <span class="dt">k =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">  )</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">emb_name &lt;-<span class="st"> "MDS"</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">embeddings &lt;-<span class="st"> </span>embeddings_mds</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw"><a href="../reference/get_scatterplots.html">get_scatterplots</a></span>(embeddings,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">                 batch,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">                 lineage) -&gt;<span class="st"> </span>dr_plots</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">    <span class="kw"><a href="../reference/get_axes_legend.html">get_axes_legend</a></span>(emb_name),</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">    <span class="kw"><a href="../reference/get_shape_legend.html">get_shape_legend</a></span>(batch, my_shape_palette)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">  <span class="kw"><a href="../reference/get_color_legend.html">get_color_legend</a></span>(lineage, my_color_palette),</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">  <span class="dt">nrow =</span> <span class="dv">2</span>) -&gt;<span class="st"> </span>legends</a>
<a class="sourceLine" id="cb15-14" data-line-number="14"></a>
<a class="sourceLine" id="cb15-15" data-line-number="15">dr_plots[[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(dr_plots)<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>legends</a>
<a class="sourceLine" id="cb15-16" data-line-number="16"></a>
<a class="sourceLine" id="cb15-17" data-line-number="17">dr_plots[[<span class="st">"nrow"</span>]] &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"></a>
<a class="sourceLine" id="cb15-19" data-line-number="19">dr_plots[[<span class="st">"labels"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>,<span class="st">""</span>)</a>
<a class="sourceLine" id="cb15-20" data-line-number="20"></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(plot_grid,dr_plots) -&gt;<span class="st"> </span>top_panel</a>
<a class="sourceLine" id="cb15-22" data-line-number="22">top_panel</a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>scmapCluster parameters</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">rowData</span>(IN_norm)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(IN_norm)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">rowData</span>(LB_norm)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(LB_norm)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">IN_norm<span class="op">$</span>cell_type1 &lt;-<span class="st"> </span>lineage[batch <span class="op">==</span><span class="st"> "Input"</span>]</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">LB_norm<span class="op">$</span>cell_type1 &lt;-<span class="st"> </span>lineage[batch <span class="op">==</span><span class="st"> "Liver bud"</span>]</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">query &lt;-<span class="st"> </span>LB_norm</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">reference &lt;-<span class="st"> </span>IN_norm</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">threshold &lt;-<span class="st"> </span><span class="fl">0.3</span></a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">gene_set &lt;-<span class="st"> </span>gene_sets[[<span class="st">"CorGI"</span>]]</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">corgi<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/corgi/topics/run_scmap">run_scmap</a></span>(</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="dt">query =</span> query,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="dt">ref =</span> reference,</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="dt">gene_set =</span> gene_set,</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  <span class="dt">threshold =</span> threshold</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; Confusion Matrix and Statistics</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;              Reference</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; Prediction    Endothelial Hepatic Mesenchymal unassigned</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;   Endothelial          53       0           0          0</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt;   Hepatic               0      53           0          0</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt;   Mesenchymal           0       0          67          0</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt;   unassigned            0       1           0          0</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co">#&gt; Overall Statistics</span></a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="co">#&gt;                                           </span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="co">#&gt;                Accuracy : 0.9943          </span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="co">#&gt;                  95% CI : (0.9684, 0.9999)</span></a>
<a class="sourceLine" id="cb17-21" data-line-number="21"><span class="co">#&gt;     No Information Rate : 0.3851          </span></a>
<a class="sourceLine" id="cb17-22" data-line-number="22"><span class="co">#&gt;     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       </span></a>
<a class="sourceLine" id="cb17-23" data-line-number="23"><span class="co">#&gt;                                           </span></a>
<a class="sourceLine" id="cb17-24" data-line-number="24"><span class="co">#&gt;                   Kappa : 0.9914          </span></a>
<a class="sourceLine" id="cb17-25" data-line-number="25"><span class="co">#&gt;  Mcnemar's Test P-Value : NA              </span></a>
<a class="sourceLine" id="cb17-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-27" data-line-number="27"><span class="co">#&gt; Statistics by Class:</span></a>
<a class="sourceLine" id="cb17-28" data-line-number="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-29" data-line-number="29"><span class="co">#&gt;                      Class: Endothelial Class: Hepatic Class: Mesenchymal</span></a>
<a class="sourceLine" id="cb17-30" data-line-number="30"><span class="co">#&gt; Sensitivity                      1.0000         0.9815             1.0000</span></a>
<a class="sourceLine" id="cb17-31" data-line-number="31"><span class="co">#&gt; Specificity                      1.0000         1.0000             1.0000</span></a>
<a class="sourceLine" id="cb17-32" data-line-number="32"><span class="co">#&gt; Pos Pred Value                   1.0000         1.0000             1.0000</span></a>
<a class="sourceLine" id="cb17-33" data-line-number="33"><span class="co">#&gt; Neg Pred Value                   1.0000         0.9917             1.0000</span></a>
<a class="sourceLine" id="cb17-34" data-line-number="34"><span class="co">#&gt; Prevalence                       0.3046         0.3103             0.3851</span></a>
<a class="sourceLine" id="cb17-35" data-line-number="35"><span class="co">#&gt; Detection Rate                   0.3046         0.3046             0.3851</span></a>
<a class="sourceLine" id="cb17-36" data-line-number="36"><span class="co">#&gt; Detection Prevalence             0.3046         0.3046             0.3851</span></a>
<a class="sourceLine" id="cb17-37" data-line-number="37"><span class="co">#&gt; Balanced Accuracy                1.0000         0.9907             1.0000</span></a>
<a class="sourceLine" id="cb17-38" data-line-number="38"><span class="co">#&gt;                      Class: unassigned</span></a>
<a class="sourceLine" id="cb17-39" data-line-number="39"><span class="co">#&gt; Sensitivity                         NA</span></a>
<a class="sourceLine" id="cb17-40" data-line-number="40"><span class="co">#&gt; Specificity                   0.994253</span></a>
<a class="sourceLine" id="cb17-41" data-line-number="41"><span class="co">#&gt; Pos Pred Value                      NA</span></a>
<a class="sourceLine" id="cb17-42" data-line-number="42"><span class="co">#&gt; Neg Pred Value                      NA</span></a>
<a class="sourceLine" id="cb17-43" data-line-number="43"><span class="co">#&gt; Prevalence                    0.000000</span></a>
<a class="sourceLine" id="cb17-44" data-line-number="44"><span class="co">#&gt; Detection Rate                0.000000</span></a>
<a class="sourceLine" id="cb17-45" data-line-number="45"><span class="co">#&gt; Detection Prevalence          0.005747</span></a>
<a class="sourceLine" id="cb17-46" data-line-number="46"><span class="co">#&gt; Balanced Accuracy                   NA</span></a></code></pre></div>
<p>Testing</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">comparison_results &lt;-</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/run_mapping_accuracy_comparison.html">run_mapping_accuracy_comparison</a></span>(</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">    <span class="dt">query =</span> IN_norm,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    <span class="dt">reference =</span> LB_norm,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="dt">gene_sets =</span> gene_sets</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">cluster_coherence_plot_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">plot_mapping_accuracy_comparison</span>(comparison_results) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Reference = Liver bud </span><span class="ch">\n</span><span class="st">Query = Input"</span>)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"></a>
<a class="sourceLine" id="cb18-11" data-line-number="11">cluster_coherence_plot_<span class="dv">1</span></a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">comparison_results &lt;-</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/run_mapping_accuracy_comparison.html">run_mapping_accuracy_comparison</a></span>(</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    <span class="dt">query =</span> LB_norm,</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    <span class="dt">reference =</span> IN_norm,</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    <span class="dt">gene_sets =</span> gene_sets</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">cluster_coherence_plot_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">plot_mapping_accuracy_comparison</span>(comparison_results) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Reference = Input </span><span class="ch">\n</span><span class="st">Query = Liver bud"</span>)</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"></a>
<a class="sourceLine" id="cb19-10" data-line-number="10">cluster_coherence_plot_<span class="dv">2</span></a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(cluster_coherence_plot_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">plot.title =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size=</span><span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">          cluster_coherence_plot_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">plot.title =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size=</span><span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">          <span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/get_legend">get_legend</a></span>(cluster_coherence_plot_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">          <span class="dt">ncol =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">          <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"F"</span>,<span class="st">"G"</span>),</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">          <span class="dt">rel_widths =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>)) -&gt;<span class="st"> </span>bottom_panel</a></code></pre></div>
</div>
<div id="out-of-sample-alignment-of-human-liver-cells" class="section level1">
<h1 class="hasAnchor">
<a href="#out-of-sample-alignment-of-human-liver-cells" class="anchor"></a>Out of sample alignment of human liver cells</h1>
<p>In the previous sections, we ran CorGI feature selection on the input and liver bud cells. We consider the <em>primary</em> human liver cells sequenced also by Camp et al.Â We analyze how genes obtained from the previous section can be used to gain insight in the new data.</p>
<p>Confer <a href="https://www.nature.com/articles/nature22796#f3">Camp et al.Â 2017, Figure 3b</a> for the cluster labels of the primary human liver cells.</p>
<div id="data-cleaning-1" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleaning-1" class="anchor"></a>Data cleaning</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gzcon">gzcon</a></span>(</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE96nnn/GSE96981/suppl/GSE96981_data.human.liver.csv.gz"</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  )</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(con)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">human_liver &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/textconnections">textConnection</a></span>(txt))</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co"># The first 13 columns are metadata</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(human_liver)[<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>]</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">mdat &lt;-<span class="st"> </span>human_liver[,<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>]</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co"># The remaining are genes</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(human_liver)[<span class="dv">14</span><span class="op">:</span><span class="dv">20</span>]</a>
<a class="sourceLine" id="cb21-14" data-line-number="14">counts &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(human_liver[,<span class="dv">14</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(human_liver)]))</a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(counts) &lt;-<span class="st"> </span>mdat<span class="op">$</span>cell_id</a>
<a class="sourceLine" id="cb21-16" data-line-number="16"></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"></a>
<a class="sourceLine" id="cb21-18" data-line-number="18">mdat<span class="op">$</span>ident &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(mdat<span class="op">$</span>ident)</a>
<a class="sourceLine" id="cb21-19" data-line-number="19"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(mdat<span class="op">$</span>tSNE_<span class="dv">1</span>,mdat<span class="op">$</span>tSNE_<span class="dv">2</span>,<span class="dt">color =</span> mdat<span class="op">$</span>ident)</a>
<a class="sourceLine" id="cb21-20" data-line-number="20"></a>
<a class="sourceLine" id="cb21-21" data-line-number="21"><span class="co"># Just to double check...</span></a>
<a class="sourceLine" id="cb21-22" data-line-number="22">mdat<span class="op">$</span>cell_type_raw &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb21-23" data-line-number="23"><span class="st">  </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(mdat<span class="op">$</span>ident,</a>
<a class="sourceLine" id="cb21-24" data-line-number="24">                  <span class="dt">from =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb21-25" data-line-number="25">                  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Lymphoblast"</span>,</a>
<a class="sourceLine" id="cb21-26" data-line-number="26">                         <span class="st">"Erythroblast"</span>,</a>
<a class="sourceLine" id="cb21-27" data-line-number="27">                         <span class="st">"Adult hepatocyte"</span>,</a>
<a class="sourceLine" id="cb21-28" data-line-number="28">                         <span class="st">"Mesenchymal"</span>,</a>
<a class="sourceLine" id="cb21-29" data-line-number="29">                         <span class="st">"Endothelial"</span>,</a>
<a class="sourceLine" id="cb21-30" data-line-number="30">                         <span class="st">"Fetal hepatocyte"</span>,</a>
<a class="sourceLine" id="cb21-31" data-line-number="31">                         <span class="st">"Kupffer"</span>))</a>
<a class="sourceLine" id="cb21-32" data-line-number="32"></a>
<a class="sourceLine" id="cb21-33" data-line-number="33">mdat_ann &lt;-<span class="st"> </span>mdat[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(mdat<span class="op">$</span>cell_type_raw)),]</a>
<a class="sourceLine" id="cb21-34" data-line-number="34">mdat_ann &lt;-<span class="st"> </span>mdat_ann[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(mdat_ann<span class="op">$</span>cell_type_raw),]</a>
<a class="sourceLine" id="cb21-35" data-line-number="35">mdat_ann[,<span class="dv">4</span>] &lt;-<span class="st"> </span>mdat_ann[,<span class="dv">4</span>] <span class="op">+</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb21-36" data-line-number="36">mdat_ann[,<span class="dv">3</span>] &lt;-<span class="st"> </span>mdat_ann[,<span class="dv">3</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb21-37" data-line-number="37"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(mdat<span class="op">$</span>tSNE_<span class="dv">1</span>,mdat<span class="op">$</span>tSNE_<span class="dv">2</span>,<span class="dt">color =</span> mdat<span class="op">$</span>cell_type_raw) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-38" data-line-number="38"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="st">"text"</span>, <span class="dt">x =</span> mdat_ann<span class="op">$</span>tSNE_<span class="dv">1</span>, <span class="dt">y =</span> mdat_ann<span class="op">$</span>tSNE_<span class="dv">2</span>, <span class="dt">font =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb21-39" data-line-number="39">           <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(mdat_ann<span class="op">$</span>cell_type_raw))</a>
<a class="sourceLine" id="cb21-40" data-line-number="40"></a>
<a class="sourceLine" id="cb21-41" data-line-number="41"><span class="co"># Collapse some of the cell types for visualization</span></a>
<a class="sourceLine" id="cb21-42" data-line-number="42">mdat<span class="op">$</span>lineage_show &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb21-43" data-line-number="43"><span class="st">  </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(mdat<span class="op">$</span>ident,</a>
<a class="sourceLine" id="cb21-44" data-line-number="44">                  <span class="dt">from =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb21-45" data-line-number="45">                  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Other"</span>,</a>
<a class="sourceLine" id="cb21-46" data-line-number="46">                         <span class="st">"Other"</span>,</a>
<a class="sourceLine" id="cb21-47" data-line-number="47">                         <span class="st">"Adult hepatocyte"</span>,</a>
<a class="sourceLine" id="cb21-48" data-line-number="48">                         <span class="st">"Mesenchymal"</span>,</a>
<a class="sourceLine" id="cb21-49" data-line-number="49">                         <span class="st">"Endothelial"</span>,</a>
<a class="sourceLine" id="cb21-50" data-line-number="50">                         <span class="st">"Fetal hepatocyte"</span>,</a>
<a class="sourceLine" id="cb21-51" data-line-number="51">                         <span class="st">"Other"</span>))</a>
<a class="sourceLine" id="cb21-52" data-line-number="52"><span class="co"># Collapse _Adult hepatocyte_ and _Immature hepatocyte_ to simply _Hepatic_ for the KNN classification part</span></a>
<a class="sourceLine" id="cb21-53" data-line-number="53">mdat<span class="op">$</span>lineage_pred &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb21-54" data-line-number="54"><span class="st">  </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(mdat<span class="op">$</span>ident,</a>
<a class="sourceLine" id="cb21-55" data-line-number="55">                  <span class="dt">from =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb21-56" data-line-number="56">                  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"unassigned"</span>,</a>
<a class="sourceLine" id="cb21-57" data-line-number="57">                         <span class="st">"unassigned"</span>,</a>
<a class="sourceLine" id="cb21-58" data-line-number="58">                         <span class="st">"Hepatic"</span>,</a>
<a class="sourceLine" id="cb21-59" data-line-number="59">                         <span class="st">"Mesenchymal"</span>,</a>
<a class="sourceLine" id="cb21-60" data-line-number="60">                         <span class="st">"Endothelial"</span>,</a>
<a class="sourceLine" id="cb21-61" data-line-number="61">                         <span class="st">"Hepatic"</span>,</a>
<a class="sourceLine" id="cb21-62" data-line-number="62">                         <span class="st">"unassigned"</span>))</a>
<a class="sourceLine" id="cb21-63" data-line-number="63">HL &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">logcounts =</span> counts),<span class="dt">colData =</span> mdat)</a></code></pre></div>
</div>
</div>
<div id="reproducing-paper-figures-1" class="section level1">
<h1 class="hasAnchor">
<a href="#reproducing-paper-figures-1" class="anchor"></a>Reproducing paper figures</h1>
<p>Combine the datasets and normalize</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">shared_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(IN),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(HL))</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">IN &lt;-<span class="st"> </span>IN[shared_genes,]</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">LB &lt;-<span class="st"> </span>LB[shared_genes,]</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">HL &lt;-<span class="st"> </span>HL[shared_genes,]</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">out &lt;-<span class="st"> </span>scran<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/multiBatchNorm">multiBatchNorm</a></span>(IN,LB,HL,<span class="dt">assay.type =</span> <span class="st">"logcounts"</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">IN &lt;-<span class="st"> </span>out[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">LB &lt;-<span class="st"> </span>out[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">HL &lt;-<span class="st"> </span>out[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"></a>
<a class="sourceLine" id="cb23-6" data-line-number="6">lineage_show &lt;-<span class="st"> </span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_c.html">fct_c</a></span>(IN<span class="op">$</span>lineage,LB<span class="op">$</span>lineage,HL<span class="op">$</span>lineage_show)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">lineage_pred &lt;-<span class="st"> </span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_c.html">fct_c</a></span>(IN<span class="op">$</span>lineage,LB<span class="op">$</span>lineage,HL<span class="op">$</span>lineage_pred)</a>
<a class="sourceLine" id="cb23-8" data-line-number="8">batch &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Input"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(IN)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Liver bud"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(LB)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Primary"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(HL)))</a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">embeddings_mnn &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">    <span class="dt">X =</span> gene_sets,</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">    <span class="dt">FUN =</span> <span class="cf">function</span>(gene_set) {</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">      mnn.out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/scran/topics/mnnCorrect">mnnCorrect</a></span>(<span class="kw">logcounts</span>(IN[gene_set,]),</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">                            <span class="kw">logcounts</span>(LB[gene_set,]),</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">                            <span class="kw">logcounts</span>(HL[gene_set,]))</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">      t.mnn &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(cbind, mnn.out<span class="op">$</span>corrected)))</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">      pca.mnn &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/prcomp">prcomp</a></span>(t.mnn, <span class="dt">rank=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(pca.mnn<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb24-11" data-line-number="11">    }</a>
<a class="sourceLine" id="cb24-12" data-line-number="12">  )</a></code></pre></div>
<p>Shorten the names</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">before &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(lineage_show)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  <span class="dt">x =</span> lineage_show,</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">  <span class="dt">from =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(lineage_show),</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">  <span class="dt">to =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Hep."</span>,<span class="st">"End."</span>,<span class="st">"Mes."</span>, <span class="st">"Fetal hep."</span>, <span class="st">"Other"</span>, <span class="st">"Adult hep."</span>)</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">) -&gt;<span class="st"> </span>lineage_show</a>
<a class="sourceLine" id="cb25-7" data-line-number="7"></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="st">`</span><span class="dt">Long name</span><span class="st">`</span> =<span class="st"> </span>before,<span class="st">`</span><span class="dt">Short name</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(lineage_show))</a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">#&gt;          Long.name Short.name</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">#&gt; 1          Hepatic       Hep.</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="co">#&gt; 2      Endothelial       End.</span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">#&gt; 3      Mesenchymal       Mes.</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co">#&gt; 4 Fetal hepatocyte Fetal hep.</span></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="co">#&gt; 5            Other      Other</span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">#&gt; 6 Adult hepatocyte Adult hep.</span></a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">emb_name &lt;-<span class="st"> "MNNPC"</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">embeddings &lt;-<span class="st"> </span>embeddings_mnn</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw"><a href="../reference/get_scatterplots.html">get_scatterplots</a></span>(embeddings,</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">                 batch,</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">                 lineage_show) -&gt;<span class="st"> </span>dr_plots</a>
<a class="sourceLine" id="cb26-6" data-line-number="6"></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(</a>
<a class="sourceLine" id="cb26-9" data-line-number="9">    <span class="kw"><a href="../reference/get_axes_legend.html">get_axes_legend</a></span>(emb_name),</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">    <span class="kw"><a href="../reference/get_shape_legend.html">get_shape_legend</a></span>(batch,my_shape_palette)</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">  <span class="kw"><a href="../reference/get_color_legend.html">get_color_legend</a></span>(lineage_show,my_color_palette,<span class="dt">ncol =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb26-13" data-line-number="13">  <span class="dt">nrow =</span> <span class="dv">2</span>) -&gt;<span class="st"> </span>legends</a>
<a class="sourceLine" id="cb26-14" data-line-number="14"></a>
<a class="sourceLine" id="cb26-15" data-line-number="15">dr_plots[[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(dr_plots)<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>legends</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">dr_plots[[<span class="st">"nrow"</span>]] &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17">dr_plots[[<span class="st">"labels"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>,<span class="st">""</span>)</a>
<a class="sourceLine" id="cb26-18" data-line-number="18"></a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(plot_grid,dr_plots) -&gt;<span class="st"> </span>top_panel</a>
<a class="sourceLine" id="cb26-20" data-line-number="20">top_panel</a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">IN_LB &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(IN,LB)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">IN_LB<span class="op">$</span>cell_type1 &lt;-<span class="st"> </span>lineage_pred[batch <span class="op">!=</span><span class="st"> "Primary"</span>]</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">HL<span class="op">$</span>cell_type1 &lt;-<span class="st"> </span>lineage_pred[batch <span class="op">==</span><span class="st"> "Primary"</span>]</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">IN<span class="op">$</span>cell_type1 &lt;-<span class="st"> </span>lineage_pred[batch <span class="op">==</span><span class="st"> "Input"</span>]</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">LB<span class="op">$</span>cell_type1 &lt;-<span class="st"> </span>lineage_pred[batch <span class="op">==</span><span class="st"> "Liver bud"</span>]</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="kw">rowData</span>(IN_LB)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(IN_LB)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="kw">rowData</span>(HL)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(HL)</a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="kw">rowData</span>(IN)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(IN)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="kw">rowData</span>(LB)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(LB)</a>
<a class="sourceLine" id="cb27-10" data-line-number="10"></a>
<a class="sourceLine" id="cb27-11" data-line-number="11">threshold &lt;-<span class="st"> </span><span class="fl">0.3</span></a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">comparison_results &lt;-</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/run_mapping_accuracy_comparison.html">run_mapping_accuracy_comparison</a></span>(</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">    <span class="dt">query =</span> IN_LB,</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">    <span class="dt">reference =</span> HL,</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">    <span class="dt">gene_sets =</span> gene_sets</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"></a>
<a class="sourceLine" id="cb28-8" data-line-number="8">cluster_coherence_plot_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">plot_mapping_accuracy_comparison</span>(comparison_results) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Reference = Human liver </span><span class="ch">\n</span><span class="st">Query = Liver bud &amp; input cell lines"</span>)</a>
<a class="sourceLine" id="cb28-10" data-line-number="10"></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">cluster_coherence_plot_<span class="dv">3</span></a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co"># unique(HL$cell_type1)</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">comparison_results &lt;-</a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/run_mapping_accuracy_comparison.html">run_mapping_accuracy_comparison</a></span>(</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">    <span class="dt">query =</span> HL,</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">    <span class="dt">reference =</span> IN_LB,</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">    <span class="dt">gene_sets =</span> gene_sets</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb29-9" data-line-number="9"></a>
<a class="sourceLine" id="cb29-10" data-line-number="10">cluster_coherence_plot_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">plot_mapping_accuracy_comparison</span>(comparison_results) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Reference = Liver bud &amp; input cell lines </span><span class="ch">\n</span><span class="st">Query = Human liver"</span>)</a>
<a class="sourceLine" id="cb29-12" data-line-number="12"></a>
<a class="sourceLine" id="cb29-13" data-line-number="13">cluster_coherence_plot_<span class="dv">4</span></a></code></pre></div>
<p><img src="liver-bud_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># get_legend(cluster_coherence_plot_3)</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(cluster_coherence_plot_<span class="dv">3</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">plot.title =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size=</span><span class="dv">10</span>))<span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb30-6" data-line-number="6">          cluster_coherence_plot_<span class="dv">4</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="st">            </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">plot.title =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size=</span><span class="dv">10</span>))<span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb30-9" data-line-number="9">          <span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/get_legend">get_legend</a></span>(cluster_coherence_plot_<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb30-10" data-line-number="10">          <span class="dt">ncol =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">          <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"F"</span>,<span class="st">"G"</span>),</a>
<a class="sourceLine" id="cb30-12" data-line-number="12">          <span class="dt">rel_widths =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>)) -&gt;<span class="st"> </span>bottom_panel</a></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(cluster_coherence_plot_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">     cluster_coherence_plot_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb31-4" data-line-number="4">     cluster_coherence_plot_<span class="dv">3</span>,</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">     cluster_coherence_plot_<span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="cf">function</span>(p)</a>
<a class="sourceLine" id="cb31-7" data-line-number="7">    p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb31-8" data-line-number="8">    ) -&gt;<span class="st"> </span>cc_plts</a>
<a class="sourceLine" id="cb31-9" data-line-number="9">cc_plts[[<span class="st">"labels"</span>]] &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb31-10" data-line-number="10">cc_lgnd &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/get_legend">get_legend</a></span>(cluster_coherence_plot_<span class="dv">1</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb31-11" data-line-number="11"><span class="st">                        </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>))</a>
<a class="sourceLine" id="cb31-12" data-line-number="12"></a>
<a class="sourceLine" id="cb31-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(<span class="dt">what =</span> plot_grid,<span class="dt">args =</span> cc_plts),</a>
<a class="sourceLine" id="cb31-14" data-line-number="14">          cc_lgnd,</a>
<a class="sourceLine" id="cb31-15" data-line-number="15">          <span class="dt">nrow =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb31-16" data-line-number="16">          <span class="dt">rel_heights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>,<span class="dv">1</span>)) -&gt;<span class="st"> </span>kappa_plt</a>
<a class="sourceLine" id="cb31-17" data-line-number="17"></a>
<a class="sourceLine" id="cb31-18" data-line-number="18"></a>
<a class="sourceLine" id="cb31-19" data-line-number="19"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span>(<span class="dt">filename =</span> <span class="st">"kappa.eps"</span>,<span class="dt">device =</span> <span class="st">"eps"</span>,<span class="dt">plot =</span> kappa_plt, <span class="dt">path =</span> <span class="st">"~/CorGI_figures/liver_bud"</span>,<span class="dt">width =</span> <span class="dv">8</span>,<span class="dt">height =</span> <span class="dv">8</span>)</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#data-cleaning">Data cleaning</a></li>
      <li>
<a href="#exploratory-analysis">Exploratory analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#pc-plot-using-all-the-genes">PC plot using all the genes</a></li>
      </ul>
</li>
      <li>
<a href="#corgi-unsupervised-feature-selection">CorGI unsupervised feature selection</a><ul class="nav nav-pills nav-stacked">
<li><a href="#selecting-the-top-corgi-genes">Selecting the top CorGI genes</a></li>
      <li><a href="#pca-on-corgi-genes">PCA on CorGI genes</a></li>
      </ul>
</li>
      <li><a href="#reproducing-paper-figures">Reproducing paper figures</a></li>
      <li>
<a href="#out-of-sample-alignment-of-human-liver-cells">Out of sample alignment of human liver cells</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data-cleaning-1">Data cleaning</a></li>
      </ul>
</li>
      <li><a href="#reproducing-paper-figures-1">Reproducing paper figures</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Yutong Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
